<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Container with LXC/LXD (1) | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Container with LXC/LXD (1)</span></h1>

<h3 class="date">Date:
2023/10/11 (initial publish),
2024/02/23 (last update)
</h3>
<h3 class="source">Source:
en/note-00050.md
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2023/10/07/debian-usability-2023a/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="/en/2023/10/20/network-1/">Next Post</a></td>
  
  </tr>
  </tbody>
</table>

<h2>TOC</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-lxc">What is LXC</a></li>
    <li><a href="#what-is-lxd-and-incus">What is LXD and Incus</a></li>
    <li><a href="#installation-of-lxd-to-debian-12">Installation of LXD to Debian 12</a></li>
    <li><a href="#tracing-first-steps-with-lxd">Tracing &ldquo;First steps with LXD&rdquo;</a>
      <ul>
        <li><a href="#getting-system-images-for-lxd">Getting system images for LXD</a></li>
        <li><a href="#inspect-instances">Inspect instances</a></li>
        <li><a href="#inspect-images">Inspect images</a></li>
        <li><a href="#inspect-filesystem">Inspect filesystem</a></li>
        <li><a href="#introduction-to-operations-on-instances">Introduction to operations on instances</a></li>
        <li><a href="#example-of-operations-on-instances">Example of operations on instances</a></li>
        <li><a href="#more-example-of-operations-on-instances-and-images">More example of operations on instances and images</a></li>
        <li><a href="#tweaking-image-content-before-starting-an-instance">Tweaking image content before starting an instance</a></li>
        <li><a href="#tweaking-metadata-of-an-image">Tweaking metadata of an image</a></li>
        <li><a href="#lxd-one-liners">LXD one liners</a></li>
      </ul>
    </li>
    <li><a href="#review-gui-tools-to-support-lxd-management">Review: GUI tools to support LXD management</a></li>
    <li><a href="#reference-lxc-and-lxd-related-commands-on-debian-12">Reference: LXC and LXD related commands on Debian 12</a></li>
    <li><a href="#references-container-landscape-essays">References: Container landscape essays</a></li>
  </ul>
</nav>

<p>Here is a series of memos of me trying to use LXC/LXD on Debian 12 (<code>bookworm</code>).</p>
<h2 id="what-is-lxc">What is LXC</h2>
<p><a href="https://linuxcontainers.org/lxc/introduction/">LXC is a well-known Linux container runtime that consists of tools, templates,
and library and language bindings. It&rsquo;s pretty low level, very flexible and
covers just about every containment feature supported by the upstream
kernel.</a></p>
<h2 id="what-is-lxd-and-incus">What is LXD and Incus</h2>
<ul>
<li>Upstream <a href="https://ubuntu.com/lxd">LXD</a> (5.18 released 2023-09-20) is at <a href="https://github.com/canonical/lxd">https://github.com/canonical/lxd</a> by Canonical
<ul>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/">LXD is a modern, secure and powerful system container and virtual machine manager.</a></li>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/tutorial/first_steps/">LXD Tutorial</a></li>
</ul>
</li>
<li>Upstream <a href="https://linuxcontainers.org/incus/">Incus</a> (0.1 released 2023-10-07) is at <a href="https://github.com/lxc/incus">https://github.com/lxc/incus</a> by linuxcontainers.org
<ul>
<li><a href="https://linuxcontainers.org/incus/docs/main/">Incus is a modern, secure and powerful system container and virtual machine manager.</a></li>
<li><a href="https://linuxcontainers.org/incus/docs/main/tutorial/first_steps/">Incus Tutorial</a></li>
<li><a href="https://linuxcontainers.org/incus/">Incus was created (2023-08-07) from LXD</a> as a fork of LXD 5.16 (released 2023-07-20).</li>
<li>&ldquo;<a href="https://discuss.linuxcontainers.org/t/incus-0-1-has-been-released/18036">Incus 0.1 has been released</a>&rdquo; announcement gives explanations on technical changes.
<ul>
<li>The command name has been changed to <code>incus</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Debian 12 LXD (5.0.2-5, packaged 2023-05-05) was created before LXD moving to Canonical and linuxcontainers.org staring <a href="https://linuxcontainers.org/incus/">Incus</a> as a LXD fork.
<ul>
<li>Debian LXD documentaion: Under <code>/usr/share/doc/lxd/</code>, especially <code>README.Debian</code>.</li>
<li>The command name is <code>lxd</code> for on Debian <code>lxd</code> package.</li>
<li>The command name is <code>lxc</code> for on Debian <code>lxd-client</code> package.</li>
</ul>
</li>
</ul>
<p>On Debian 12, there is no need to use snap package mentioned in LXD documentation from Ubuntu/Canonical since it is fairly new one.</p>
<p>Future Debian may migrate to Incus.  So for the future proof, I should interact with instances only through <code>/1.0/instances</code> as in Incus when using Debian 12 LXD.</p>
<p>For now, I will focus on <em>container</em> usages on Debian 12.</p>
<h2 id="installation-of-lxd-to-debian-12">Installation of LXD to Debian 12</h2>
<p>On a Debian 12 system with its <code>/var/lib</code> on btrfs, I run following commands to
install LXD.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ sudo aptitude install lxc lxd lxd-tools
</span></span><span style="display:flex;"><span> $ sudo adduser osamu lxd
</span></span><span style="display:flex;"><span> $ sudo newusers group
</span></span><span style="display:flex;"><span> $ sudo lxd init
</span></span><span style="display:flex;"><span>  ... go with defaults
</span></span></code></pre></div><p>This seems to create the <code>/var/lib/lxd/images/</code> directory.</p>
<h2 id="tracing-first-steps-with-lxd">Tracing &ldquo;First steps with LXD&rdquo;</h2>
<p>I traced &ldquo;First steps with LXD&rdquo; with some extra operations to check what is
really happening.</p>
<h3 id="getting-system-images-for-lxd">Getting system images for LXD</h3>
<p>Since manpage for <code>lxc-launch</code> on Debian 12 is useless, let&rsquo;s see:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc launch -h
</span></span><span style="display:flex;"><span>Description:
</span></span><span style="display:flex;"><span>  Create and start instances from images
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Usage:
</span></span><span style="display:flex;"><span>  lxc launch [&lt;remote&gt;:]&lt;image&gt; [&lt;remote&gt;:][&lt;name&gt;] [flags]
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Full list of <code>remote</code> is available by issuing <code>lxc remote list</code>.  Notable ones
are:</p>
<ul>
<li><code>images</code> for all images at <a href="https://images.linuxcontainers.org/">https://images.linuxcontainers.org/</a></li>
<li><code>ubuntu</code> for specifically Ubuntu images at <a href="https://cloud-images.ubuntu.com/releases">https://cloud-images.ubuntu.com/releases</a></li>
</ul>
<p>Let me create and start instances from images for &ldquo;Ubuntu 22.04&rdquo; and &ldquo;Debian 12&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc launch images:debian/12 debian-12
</span></span><span style="display:flex;"><span> $ lxc launch ubuntu:22.04 ubuntu-2204
</span></span></code></pre></div><p>System images specified as <code>ubuntu:22.04</code> or <code>images:debian/12</code> are downloaded
to <code>/var/lib/lxd/images/</code>.  Each of these seems to be made of 2 files.  One for
rootfs and another for templates(?) sharing the same hash value as a part of
their file name. These images seems to be offered in a squashfs. The hash
values are listed by <code>lxc images ls</code>.  The same hash values are used for the
directory name under <code>/var/lib/lxd/storage-pools/default/images/</code> too.</p>
<p>The first invocation of <code>lxc launch</code> for an image seems to download it while
its subsequent invocations seems to use the previously downloaded corresponding
image.</p>
<p>Local instance names are <code>ubuntu-2204</code> and <code>debian-12</code>.   They seem to be
created under <code>/var/lib/lxd/containers/</code>.  These instance names are listed by
<code>lxc ls</code> and also used for the directory name under
<code>/var/lib/lxd/storage-pools/default/containers</code></p>
<p>Here:<code>lxc launch ...</code> = <code>lxc init ...</code> + <code>lxc start ...</code></p>
<h3 id="inspect-instances">Inspect instances</h3>
<p>Let me inspect instances.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc list
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span><span style="display:flex;"><span>|    NAME     |  STATE  |         IPV4         |                    IPV6                     |   TYPE    | SNAPSHOTS |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span><span style="display:flex;"><span>| debian-12   | RUNNING | 10.30.104.128 (eth0) | fd42:2b6:d45:cc06:216:3eff:febf:4ec6 (eth0) | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span><span style="display:flex;"><span>| ubuntu-2204 | RUNNING | 10.30.104.155 (eth0) | fd42:2b6:d45:cc06:216:3eff:fecc:8b51 (eth0) | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span></code></pre></div><p>Let me stop these instances and inspect them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc stop debian-12
</span></span><span style="display:flex;"><span> $ lxc stop ubuntu-2204
</span></span><span style="display:flex;"><span> $ lxc list
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>|    NAME     |  STATE  | IPV4 | IPV6 |   TYPE    | SNAPSHOTS |
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>| debian-12   | STOPPED |      |      | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>| ubuntu-2204 | STOPPED |      |      | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span></code></pre></div><p>More detailed information can be obtained:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc info debian-12
</span></span><span style="display:flex;"><span>Name: debian-12
</span></span><span style="display:flex;"><span>Status: STOPPED
</span></span><span style="display:flex;"><span>Type: container
</span></span><span style="display:flex;"><span>Architecture: x86_64
</span></span><span style="display:flex;"><span>Created: 2023/10/11 10:59 JST
</span></span><span style="display:flex;"><span>Last Used: 2023/10/12 05:08 JST
</span></span></code></pre></div><p>Let me turn-on <code>debian-12</code> and quickly inspect it twice in the row.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc start debian-12
</span></span><span style="display:flex;"><span> $ lxc list
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>|    NAME     |  STATE  | IPV4 | IPV6 |   TYPE    | SNAPSHOTS |
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>| debian-12   | RUNNING |      |      | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>| ubuntu-2204 | STOPPED |      |      | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+------+------+-----------+-----------+
</span></span><span style="display:flex;"><span> $ lxc list
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span><span style="display:flex;"><span>|    NAME     |  STATE  |         IPV4         |                    IPV6                     |   TYPE    | SNAPSHOTS |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span><span style="display:flex;"><span>| debian-12   | RUNNING | 10.30.104.128 (eth0) | fd42:2b6:d45:cc06:216:3eff:febf:4ec6 (eth0) | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span><span style="display:flex;"><span>| ubuntu-2204 | STOPPED |                      |                                             | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+---------------------------------------------+-----------+-----------+
</span></span></code></pre></div><p>This changed results are because of slow network activation.</p>
<p>Let me set IPV6 network configuration to be disabled.  I need to restart it
to activate this network configuration change.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc network set lxdbr0 ipv6.address none
</span></span><span style="display:flex;"><span> $ lxc restart debian-12
</span></span><span style="display:flex;"><span> $ lxc list
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>|    NAME     |  STATE  |        IPV4          | IPV6 |   TYPE    | SNAPSHOTS |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>| debian-12   | RUNNING | 10.30.104.128 (eth0) |      | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+------+-----------+-----------+
</span></span><span style="display:flex;"><span>| ubuntu-2204 | STOPPED |                      |      | CONTAINER | 0         |
</span></span><span style="display:flex;"><span>+-------------+---------+----------------------+------+-----------+-----------+
</span></span></code></pre></div><p>The fact of changing results for repeated last 2 commands indicate that establishment of network address takes time.</p>
<h3 id="inspect-images">Inspect images</h3>
<p>Let me inspect images</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc image list
</span></span><span style="display:flex;"><span>+-------+--------------+--------+---------------------------------------------+--------------+-----------+----------+-------------------------------+
</span></span><span style="display:flex;"><span>| ALIAS | FINGERPRINT  | PUBLIC |                 DESCRIPTION                 | ARCHITECTURE |   TYPE    |   SIZE   |          UPLOAD DATE          |
</span></span><span style="display:flex;"><span>+-------+--------------+--------+---------------------------------------------+--------------+-----------+----------+-------------------------------+
</span></span><span style="display:flex;"><span>|       | 80496135241f | no     | Debian bookworm amd64 (20231012_05:24)      | x86_64       | CONTAINER | 94.20MB  | Oct 12, 2023 at 8:07am (UTC)  |
</span></span><span style="display:flex;"><span>+-------+--------------+--------+---------------------------------------------+--------------+-----------+----------+-------------------------------+
</span></span><span style="display:flex;"><span>|       | b948dd91cd5a | no     | ubuntu 22.04 LTS amd64 (release) (20231010) | x86_64       | CONTAINER | 435.08MB | Oct 10, 2023 at 10:20am (UTC) |
</span></span><span style="display:flex;"><span>+-------+--------------+--------+---------------------------------------------+--------------+-----------+----------+-------------------------------+
</span></span></code></pre></div><h3 id="inspect-filesystem">Inspect filesystem</h3>
<p>Let&rsquo;s see how all these images and instances are stored under <code>/var/lib/lxd</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ sudo btrfs subvolume list /var/lib/lxd|grep &#34;var/lib/lxd&#34;
</span></span><span style="display:flex;"><span>ID 42668 gen 1952301 top level 22924 path var/lib/lxd/storage-pools/default
</span></span><span style="display:flex;"><span>ID 43251 gen 1951314 top level 42668 path var/lib/lxd/storage-pools/default/images/b948dd91cd5a8da89f6dcd4949d7189f064cf6d4dc5bd70b7f9b7aff1883babf
</span></span><span style="display:flex;"><span>ID 43284 gen 1952313 top level 42668 path var/lib/lxd/storage-pools/default/containers/debian-12
</span></span><span style="display:flex;"><span>ID 43315 gen 1951563 top level 42668 path var/lib/lxd/storage-pools/default/containers/ubuntu-2204
</span></span><span style="display:flex;"><span>ID 43369 gen 1952233 top level 42668 path var/lib/lxd/storage-pools/default/images/80496135241fade673df5db2b3a8d3fca280370b17578227892776839bbeb678
</span></span><span style="display:flex;"><span> $ sudo ls -li /var/lib/lxd/storage-pools/default/images
</span></span><span style="display:flex;"><span>total 0
</span></span><span style="display:flex;"><span>256 drwx--x--x 1 root root 56 Oct 12 17:07 80496135241fade673df5db2b3a8d3fca280370b17578227892776839bbeb678
</span></span><span style="display:flex;"><span>256 drwx--x--x 1 root root 56 Oct 10 19:20 b948dd91cd5a8da89f6dcd4949d7189f064cf6d4dc5bd70b7f9b7aff1883babf
</span></span><span style="display:flex;"><span> $ sudo ls -li /var/lib/lxd/storage-pools/default/containers
</span></span><span style="display:flex;"><span>total 0
</span></span><span style="display:flex;"><span>256 d--x------ 1 231072 root 78 Oct 11 10:59 debian-12
</span></span><span style="display:flex;"><span>256 d--x------ 1 root   root 78 Oct 11 21:53 ubuntu-2204
</span></span></code></pre></div><p>I see btrfs subvolume is generated here.  <code>inode=256</code> means the root of btrfs subvolume.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ sudo ls -l /var/lib/lxd/images
</span></span><span style="display:flex;"><span>total 541992
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 root root       680 Oct 12 17:07 80496135241fade673df5db2b3a8d3fca280370b17578227892776839bbeb678
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 root root  98775040 Oct 12 17:07 80496135241fade673df5db2b3a8d3fca280370b17578227892776839bbeb678.rootfs
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 root root       412 Oct 10 19:20 b948dd91cd5a8da89f6dcd4949d7189f064cf6d4dc5bd70b7f9b7aff1883babf
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 root root 456216576 Oct 10 19:20 b948dd91cd5a8da89f6dcd4949d7189f064cf6d4dc5bd70b7f9b7aff1883babf.rootfs
</span></span></code></pre></div><p>These seem to be downloaded squashfs files</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ sudo bash -c &#34;ls -il /var/lib/lxd/storage-pools/default/images/80496135241f*&#34;
</span></span><span style="display:flex;"><span>total 4
</span></span><span style="display:flex;"><span>257 -rw-r--r-- 1 root root 535 Oct 12 14:29 metadata.yaml
</span></span><span style="display:flex;"><span>261 drwxr-xr-x 1 root root 154 Oct 12 14:29 rootfs
</span></span><span style="display:flex;"><span>258 drwxr-xr-x 1 root root  42 Oct 12 14:29 templates
</span></span><span style="display:flex;"><span> $ sudo bash -c &#34;ls -l /var/lib/lxd/storage-pools/default/images/80496135241f*/rootfs&#34;
</span></span><span style="display:flex;"><span>total 24
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    7 Oct 12 14:25 bin -&gt; usr/bin
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 boot
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 12 14:29 dev
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root 1570 Oct 12 14:29 etc
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 home
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    7 Oct 12 14:25 lib -&gt; usr/lib
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    9 Oct 12 14:25 lib32 -&gt; usr/lib32
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    9 Oct 12 14:25 lib64 -&gt; usr/lib64
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root   10 Oct 12 14:25 libx32 -&gt; usr/libx32
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 12 14:25 media
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 12 14:25 mnt
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 12 14:25 opt
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 proc
</span></span><span style="display:flex;"><span>drwx------ 1 root root   38 Oct 12 14:25 root
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 12 14:25 run
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    8 Oct 12 14:25 sbin -&gt; usr/sbin
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 12 14:25 srv
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 sys
</span></span><span style="display:flex;"><span>drwxrwxrwt 1 root root    0 Oct 12 14:25 tmp
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root  116 Oct 12 14:25 usr
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root   90 Oct 12 14:25 var
</span></span><span style="display:flex;"><span> $ sudo ls -l /var/lib/lxd/storage-pools/default/containers/debian-12
</span></span><span style="display:flex;"><span>total 8
</span></span><span style="display:flex;"><span>-r-------- 1 root root 3136 Oct 12 19:38 backup.yaml
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 root root  535 Oct 10 14:28 metadata.yaml
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root  154 Oct 10 14:28 rootfs
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root   42 Oct 10 14:28 templates
</span></span><span style="display:flex;"><span> $ sudo ls -l /var/lib/lxd/storage-pools/default/containers/debian-12/rootfs
</span></span><span style="display:flex;"><span>total 24
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    7 Oct 10 14:25 bin -&gt; usr/bin
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 boot
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 10 14:28 dev
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root 1570 Oct 10 14:28 etc
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 home
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    7 Oct 10 14:25 lib -&gt; usr/lib
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    9 Oct 10 14:25 lib32 -&gt; usr/lib32
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    9 Oct 10 14:25 lib64 -&gt; usr/lib64
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root   10 Oct 10 14:25 libx32 -&gt; usr/libx32
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 10 14:25 media
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 10 14:25 mnt
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 10 14:25 opt
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 proc
</span></span><span style="display:flex;"><span>drwx------ 1 root root   38 Oct 10 14:25 root
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 10 14:25 run
</span></span><span style="display:flex;"><span>lrwxrwxrwx 1 root root    8 Oct 10 14:25 sbin -&gt; usr/sbin
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Oct 10 14:25 srv
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root    0 Sep 30 05:04 sys
</span></span><span style="display:flex;"><span>drwxrwxrwt 1 root root   74 Oct 12 19:44 tmp
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root  116 Oct 10 14:25 usr
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root   90 Oct 10 14:25 var
</span></span></code></pre></div><p>I see btrfs subvolume is used for each file tree based on images and instances.</p>
<p>Hmmm&hellip;. <code>debian-12</code> is owned by <code>231072</code> while <code>ubuntu-2204</code> is owned by <code>root</code> for directory under <code>/var/lib/lxd/storage-pools/default/containers</code>. The uid=<code>231072</code> is found in <code>/etc/subuid</code> as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>_lxd:231072:10000001
</span></span><span style="display:flex;"><span>root:231072:10000001
</span></span></code></pre></div><p>This directory ownership changes:</p>
<ul>
<li>from <code>root</code> to <code>231072</code> when container state is changed from <code>STOPPED</code> to <code>RUNNING</code>.</li>
<li>from <code>231072</code> to <code>root</code> when container state is changed from <code>RUNNING</code> to <code>STOPPED</code>.</li>
</ul>
<p>I also realized that <code>/etc/passwd</code> files inside of the above mentioned
container images and instances don&rsquo;t have the normal <code>uid=1000</code> user.</p>
<p>As I checked this Debian image, I realize that this is a minimalistic one and doesn&rsquo;t include <code>cloud-init</code> nor <code>netplan.io</code> packages.  This was because I didn&rsquo;t specify the <code>/cloud</code> suffix when <code>lxc lauch ...</code> was used.  See <a href="https://documentation.ubuntu.com/lxd/en/latest/cloud-init/#cloud-init-support-in-images">cloud-init support in images</a>.</p>
<h3 id="introduction-to-operations-on-instances">Introduction to operations on instances</h3>
<p>I followed more in &ldquo;<a href="https://documentation.ubuntu.com/lxd/en/latest/tutorial/first_steps/">First steps with LXD</a>&rdquo; and &ldquo;<a href="https://documentation.ubuntu.com/lxd/en/latest/howto/">How-to guides</a>&rdquo; (Especially around &ldquo;<a href="https://documentation.ubuntu.com/lxd/en/latest/instances/">Instances</a>&rdquo; section) to learn operations on container instances.</p>
<ul>
<li><code>lxc copy ...</code> to duplicate a container instance.</li>
<li><code>lxc delete ...</code> to delete a container instance.</li>
<li><code>lxc exec ...</code> to execute a command as root within the instance</li>
<li><code>lxc config ...</code> to configure container instances with <a href="https://documentation.ubuntu.com/lxd/en/latest/reference/instance_options/#instance-options">instance options</a>
<ul>
<li>This can provide <a href="https://documentation.ubuntu.com/lxd/en/latest/reference/instance_options/#instance-options-cloud-init">cloud-init configuration</a>.</li>
</ul>
</li>
<li><code>lxc restart ...</code> to stop and start a container instance to reload the updated configuration.</li>
<li><code>lxc file edit ...</code> to edit a file in a container instance.</li>
<li><code>lxc file push ...</code> to copy a file to a container instance.</li>
<li><code>lxc file pull ...</code> to copy a file from a container instance.</li>
<li><code>lxc snapshot ...</code> to make snapshot of a container instance.</li>
</ul>
<p>Issues of different UID between outside and inside of the container can be taken care nicely with above commands.</p>
<h3 id="example-of-operations-on-instances">Example of operations on instances</h3>
<p>Here is an example of basic operations on instances.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc copy debian-12 debian-12-ephemerical
</span></span><span style="display:flex;"><span> $ lxc exec debian-12-ephemerical -- adduser osamu
</span></span><span style="display:flex;"><span>Adding user `osamu&#39; ...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span> $ lxc start  debian-12-ephemerical --console
</span></span><span style="display:flex;"><span>To detach from the console, press: &lt;ctrl&gt;+a q
</span></span><span style="display:flex;"><span>Queued start job for default target graphical.target.
</span></span><span style="display:flex;"><span>[  OK  ] Created slice system-getty.slice - Slice /system/getty.
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>[  OK  ] Finished systemd-update-utmp-runlev… - Record Runlevel Change in UTMP.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Debian GNU/Linux 12 debian-12-ephemerical console
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>debian-12-ephemerical login: osamu
</span></span><span style="display:flex;"><span>Password:
</span></span><span style="display:flex;"><span>Linux debian-12-ephemerical 6.4.0-0.deb12.2-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.4.4-3~bpo12+1 (2023-08-08) x86_64
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style="display:flex;"><span>the exact distribution terms for each program are described in the
</span></span><span style="display:flex;"><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style="display:flex;"><span>permitted by applicable law.
</span></span><span style="display:flex;"><span>osamu@debian-12-ephemerical:~$
</span></span></code></pre></div><p>One can detach from the console for the container instance with <code>CTRL-A+q</code> and gain console for the host machine.  One can regain access to the console for the container instance by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc console debian-12-ephemerical
</span></span><span style="display:flex;"><span>To detach from the console, press: &lt;ctrl&gt;+a q
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>osamu@debian-12-ephemerical:~$
</span></span></code></pre></div><p>You can stop and delete this instance from the console on the host machine as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc stop debian-12-ephemerical
</span></span><span style="display:flex;"><span> $ lxc delete debian-12-ephemerical
</span></span></code></pre></div><h3 id="more-example-of-operations-on-instances-and-images">More example of operations on instances and images</h3>
<p>Let&rsquo;s play more &hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ cd path/to/working-space
</span></span><span style="display:flex;"><span> $ lxc init images:debian/bookworm/cloud dbc
</span></span><span style="display:flex;"><span> $ lxc start dbc
</span></span><span style="display:flex;"><span> $ lxc export dbc backup-dbc.tar.gz
</span></span><span style="display:flex;"><span> $ lxc stop dbc
</span></span><span style="display:flex;"><span> $ lxc publish dbc --alias idbc
</span></span><span style="display:flex;"><span> $ lxc image export idbc
</span></span></code></pre></div><p>Initial downloaded image get downloaded in 2 files.  One with <code>.rootfs</code>
extension and the other smaller file with the same filename without <code>.rootfs</code>
extension to <code>/var/lib/lxd/images</code>.  This is PUBLIC=yes image.  This filename
is long hash string.</p>
<p>The created instance creates symlink in <code>/var/lib/lxd/containers</code> with its
name.  It points to a directory with the same name in
<code>/var/lib/lxd/storage-pools/default/containers</code>. This directory holds an open
file tree of image contents of PUBLIC=no ones only.</p>
<p>The published image created from instance is a single file with PUBLIC=no in
<code>/var/lib/lxd/images</code>.</p>
<p><code>/var/lib/lxd/storage-pools/default/images</code> has long hash named directories
each of which holds an open tree of image contents of PUBLIC=no ones only.</p>
<p>When you export, <code>tar.gz</code> of image is created.  It has file tree like ones
under <code>/var/lib/lxd/storage-pools/default/images</code> in it for both PUBLIC=yes and
no.</p>
<ul>
<li><code>/var/lib/lxd/images</code>
<ul>
<li>all accessble images (local and copy of remote)</li>
<li>image in 1 or 2 files with autogenerated hash name</li>
</ul>
</li>
<li><code>/var/lib/lxd/storage-pools/default/images</code>
<ul>
<li>all local images as subdirectories in it</li>
<li>each subdirectory as an open file tree</li>
<li>subdirectory name as image name with autogenerated hash name</li>
<li>subdirectory contains:
<ul>
<li><code>rootfs/</code></li>
<li><code>templates/</code></li>
<li><code>metadata.yaml</code></li>
</ul>
</li>
</ul>
</li>
<li><code>/var/lib/lxd/storage-pools/default/containers</code>
<ul>
<li>all instances of containers as subdirectories in it</li>
<li>each subdirectory as an open file tree</li>
<li>subdirectory name as container name with instance name</li>
<li>subdirectory contains:
<ul>
<li><code>rootfs/</code></li>
<li><code>templates/</code></li>
<li><code>metadata.yaml</code></li>
<li><code>backup.yaml</code></li>
</ul>
</li>
</ul>
</li>
<li><code>path/to/working-space</code>
<ul>
<li><code>backup-dbc.tar.gz</code> holding a backup of an instance</li>
<li><code>&lt;long_hash_name&gt;.tar.gz</code> holding an exported image</li>
</ul>
</li>
</ul>
<p>Supose there are 2 types of images:</p>
<ul>
<li>Unified taraball:  32988437b9eec43d0a87f1e7dbbbf02f27a2525cd1379a9d73f1b95774572a92</li>
<li>Split tarballs: 187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3 187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3.rootfs</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> # cd /var/lib/lxd/images
</span></span><span style="display:flex;"><span> # file 187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3
</span></span><span style="display:flex;"><span>187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3: XZ compressed data, checksum CRC64
</span></span><span style="display:flex;"><span> # file 187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3.rootfs
</span></span><span style="display:flex;"><span>187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3.rootfs: Squashfs filesystem, little endian, version 4.0, xz compressed, 456497140 bytes, 42504 inodes, blocksize: 131072 bytes, created: Thu Oct 26 02:21:34 2023
</span></span><span style="display:flex;"><span> # file 32988437b9eec43d0a87f1e7dbbbf02f27a2525cd1379a9d73f1b95774572a92
</span></span><span style="display:flex;"><span>32988437b9eec43d0a87f1e7dbbbf02f27a2525cd1379a9d73f1b95774572a92: gzip compressed data, from Unix, original size modulo 2^32 524245504 gzip compressed data, unknown method, ASCII, has CRC, from FAT filesystem (MS-DOS, OS/2, NT), original size modulo 2^32 524245504
</span></span><span style="display:flex;"><span> # sha256sum 32988437b9eec43d0a87f1e7dbbbf02f27a2525cd1379a9d73f1b95774572a92
</span></span><span style="display:flex;"><span>32988437b9eec43d0a87f1e7dbbbf02f27a2525cd1379a9d73f1b95774572a92  32988437b9eec43d0a87f1e7dbbbf02f27a2525cd1379a9d73f1b95774572a92
</span></span><span style="display:flex;"><span> # sha256sum &lt;(cat 187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3 187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3.rootfs)
</span></span><span style="display:flex;"><span>187a9674b77056a0d466f5058ea72660cb52430dcdf06974ca8cd6c5a47fb6b3  /dev/fd/63
</span></span></code></pre></div><p>See:</p>
<ul>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/reference/image_format">image format</a>
<ul>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/image-handling/#unified-tarball">Unified tarball</a>
<ul>
<li>the SHA-256 of the tarball (tar.gz)</li>
</ul>
</li>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/image-handling/#split-tarballs">Split tarballs</a>
<ul>
<li>the SHA-256 of the concatenation of the metadata (xz) and rootfs tarball (squashfs, xz) (in this order)</li>
</ul>
</li>
</ul>
</li>
<li>instance backup and recovery
<ul>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/backup">How to back up a LXD server</a></li>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/howto/disaster_recovery/">How to recover instances in case of disaster</a></li>
</ul>
</li>
<li><a href="https://ubuntu.com/tutorials/create-custom-lxd-images">Creating custom LXD images</a></li>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/howto/images_remote/">How to use remote images</a>
<ul>
<li><a href="https://documentation.ubuntu.com/lxd/en/latest/reference/remote_image_servers/#remote-server-types">Remote server types</a></li>
<li><a href="https://discuss.linuxcontainers.org/t/image-server-infrastructure/16647">Image server infrastructure</a></li>
</ul>
</li>
</ul>
<h3 id="tweaking-image-content-before-starting-an-instance">Tweaking image content before starting an instance</h3>
<p>I realized current Debian bookworm has <code>cloud-init</code> with a
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1055786">bug #1055786</a>.</p>
<p>Here is how I get around this problem by removing toxic <code>netdev</code> out of
installed file <code>/etc/cloud/cloud.cfg</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ cd path/to
</span></span><span style="display:flex;"><span> $ lxc init images:debian/bookworm/cloud dbc0
</span></span><span style="display:flex;"><span> $ lxc file pull dbc0/etc/cloud/cloud.cfg .
</span></span><span style="display:flex;"><span> $ sed -i -e &#39;s/ netdev,//&#39; cloud.cfg
</span></span><span style="display:flex;"><span> $ lxc file push cloud.cfg dbc0/etc/cloud/
</span></span><span style="display:flex;"><span> $ lxc publish dbc0 --alias dbc
</span></span><span style="display:flex;"><span>Instance published with fingerprint: 379e858cc15808dbdf6a27a028a8b0098213656c0b4565bbc1b64b90b61d9dbd
</span></span><span style="display:flex;"><span> $ lxc start dbc0
</span></span><span style="display:flex;"><span> $ lxc launch dbc dbc1
</span></span></code></pre></div><p>Now I have a fixed image <code>379e858cc15808dbdf6a27a028a8b0098213656c0b4565bbc1b64b90b61d9dbd</code> with its alias <code>dbc</code> as a local image.</p>
<p>2 fixed instances<code>dbc0</code> and <code>dbc1</code> running.</p>
<p>I needed <code>lxc pull ...</code> + substitution + <code>lxc push ...</code> combination in the
above commmand sequence since I wanted these file modification to happen before
starting instance. (<code>lxc exec ... -- command ...</code> requires running instance)</p>
<p>You can see this behavior as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ lxc stop dbc0
</span></span><span style="display:flex;"><span>$ lxc exec dbc0 -- echo <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>Error: Instance is not running
</span></span><span style="display:flex;"><span>$ lxc start dbc0
</span></span><span style="display:flex;"><span>$ lxc exec dbc0 -- echo <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>Hello
</span></span></code></pre></div><p>For interactive modification, <code>lxc pull ...</code> + substitution + <code>lxc push ...</code>
combination here can be replaced with <code>lxc file edit dbc0/etc/cloud/cloud.cfg</code>.</p>
<p>This allows me easily change other values such as the primary account name <code>debian</code>.</p>
<h3 id="tweaking-metadata-of-an-image">Tweaking metadata of an image</h3>
<p>If you wish to also change <code>image.description</code> and <code>image.name</code> of an image,
use <code>lxc config metadata edit dbz0</code> to the instance before publishing.  Then
the published image file in <code>/var/lib/lxd/images/</code> and corresponding
<code>/var/lib/lxd/storage-pools/default/images/</code> has updated names.</p>
<p>Editing with published image like <code>lxc image edit dbc</code> doesn&rsquo;t change image
data in these directory nor hash value used for the image name but updates
description displayed by <code>lxc image ls dbc</code>.</p>
<p>Although there seem to be only interactive editor available to modify metadata, you can do more with this by changing actual program for editor via exported environment variables <code>EDITOR</code> and <code>VISUAL</code> (<code>VISUAL</code> supersedes <code>EDITOR</code>).</p>
<p>To get a copy of <code>metadata.yaml</code> as the <code>copy_metadata.yaml</code> on the host</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ unset VISUAL
</span></span><span style="display:flex;"><span> $ export EDITOR=cat
</span></span><span style="display:flex;"><span> $ lxc config metadata edit d0 &gt;copy_metadata.yaml
</span></span></code></pre></div><p>To update the <code>metadata.yaml</code> with the <code>copy_metadata.yaml</code> on the host</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ unset VISUAL
</span></span><span style="display:flex;"><span> $ export EDITOR=&#34;tee&#34;
</span></span><span style="display:flex;"><span> $ lxc config metadata edit d0 &lt;copy_metadata.yaml
</span></span></code></pre></div><h3 id="lxd-one-liners">LXD one liners</h3>
<p>Stop all instances:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ for f in $(lxc ls -cn -fcsv) ; do lxc stop $f; done
</span></span></code></pre></div><p>Delete all instances:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ for f in $(lxc ls -cn -fcsv) ; do lxc delete $f; done
</span></span></code></pre></div><p>Delete all images:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ for f in $(lxc image ls -cf -fcsv) ; do lxc image delete $f; done
</span></span></code></pre></div><p>Delete all images without alias:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ for f in $(lxc image ls -cfl -fcsv|sed -ne &#34;/,$/s/,//p&#34;) ; do lxc image delete $f; done
</span></span></code></pre></div><p>Delete all images with alias:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ for f in $(lxc image ls -cfl -fcsv|sed -ne &#34;/,..*$/s/,.*$//p&#34;) ; do lxc image delete $f; done
</span></span></code></pre></div><p>I think I got some glimpses of LXC/LXD commmands.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="review-gui-tools-to-support-lxd-management">Review: GUI tools to support LXD management</h2>
<p>Debian 12 doesn&rsquo;t ship any GUI tools for LXD.</p>
<p>I decided to give up on finding good GUI tools for LXD after my cursory research as below.</p>
<p>Canonical provides snap package for lxd containing <a href="https://github.com/canonical/lxd-ui">lxd-ui</a> which is based on TypeScript and JavaScript (actively updated).  This offers easy and accessible container and virtual machine management with a browser interface for LXD.  But adding lxd-ui to Debian lxd is non-trivial.</p>
<p>Mw web search finds GUI UI candidates but no luck on their usability &hellip;:</p>
<ul>
<li><a href="https://github.com/AdaptiveScale/lxdui">lxdui</a> by AdaptiveScale (py, sh, 2 years) &ndash; <a href="https://github.com/AdaptiveScale/lxdui/wiki/Installing-LXDUI-2.0">installation guide</a> &ndash; Fails to install even if I use <a href="https://github.com/AdaptiveScale/lxdui/pull/364">PR364</a> &hellip; too many un-applied PRs</li>
<li><a href="https://github.com/Miso-K/lxdmanager-vue-dashboard">lxdmanager-vue-dashboard</a> and <a href="https://github.com/Miso-K/lxd-api-gateway">lxd-api-gateway</a> by Miso-K (vue, js, 2 year)</li>
<li><a href="https://lxdware.com/">LXD dashboard</a> by lxdware (PHP, last year)</li>
<li><a href="https://github.com/nuber-io/nuber">nuber</a> (PHP, 2022-07-11)</li>
</ul>
<h2 id="reference-lxc-and-lxd-related-commands-on-debian-12">Reference: LXC and LXD related commands on Debian 12</h2>
<p>&ldquo;<a href="https://documentation.ubuntu.com/lxd/en/latest/explanation/lxd_lxc/">About lxd and lxc</a>&rdquo; explains a bit confusing situation of LXC and LXD.</p>
<p>The <code>lxc</code> command with many subcommands in the <code>lxd-client</code> package seems to be the primary tool to use LXC/LXD.  Many hyphenated <code>lxc-*</code> commands in the <code>lxc</code> package are not the primary tools for the administrator.</p>
<p>When migration to <a href="https://linuxcontainers.org/incus/">Incus</a> happens, the <code>lxc</code> command in <code>lxd-client</code> seems to be renamed to <code>incus</code>.</p>
<ul>
<li>The <code>lxd-client</code> package pulled in by <code>lxd</code> offers <code>lxc</code> command with many subcommands.  Auto-generated manpages on Debian 12 are mostly useless. Use <code>-h</code> with command to see reasonable command usage syntax.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxc -h --all --sub-commands
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Description:
</span></span><span style="display:flex;"><span>  Command line client for LXD
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  All of LXD&#39;s features can be driven through the various commands below.
</span></span><span style="display:flex;"><span>  For help with any of those, simply call them with --help.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Usage:
</span></span><span style="display:flex;"><span>  lxc [command]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Available Commands:
</span></span><span style="display:flex;"><span>  alias        Manage command aliases
</span></span><span style="display:flex;"><span>    add          Add new aliases
</span></span><span style="display:flex;"><span>    list         List aliases
</span></span><span style="display:flex;"><span>    remove       Remove aliases
</span></span><span style="display:flex;"><span>    rename       Rename aliases
</span></span><span style="display:flex;"><span>  cluster      Manage cluster members
</span></span><span style="display:flex;"><span>    add                 Request a join token for adding a cluster member
</span></span><span style="display:flex;"><span>    edit                Edit cluster member configurations as YAML
</span></span><span style="display:flex;"><span>    enable              Enable clustering on a single non-clustered LXD server
</span></span><span style="display:flex;"><span>    evacuate            Evacuate cluster member
</span></span><span style="display:flex;"><span>    get                 Get values for cluster member configuration keys
</span></span><span style="display:flex;"><span>    group               Manage cluster groups
</span></span><span style="display:flex;"><span>      assign       Assign sets of groups to cluster members
</span></span><span style="display:flex;"><span>      create       Create a cluster group
</span></span><span style="display:flex;"><span>      delete       Delete a cluster group
</span></span><span style="display:flex;"><span>      edit         Edit a cluster group
</span></span><span style="display:flex;"><span>      list         List all the cluster groups
</span></span><span style="display:flex;"><span>      remove       Remove member from group
</span></span><span style="display:flex;"><span>      rename       Rename a cluster group
</span></span><span style="display:flex;"><span>      show         Show cluster group configurations
</span></span><span style="display:flex;"><span>    list                List all the cluster members
</span></span><span style="display:flex;"><span>    list-tokens         List all active cluster member join tokens
</span></span><span style="display:flex;"><span>    remove              Remove a member from the cluster
</span></span><span style="display:flex;"><span>    rename              Rename a cluster member
</span></span><span style="display:flex;"><span>    restore             Restore cluster member
</span></span><span style="display:flex;"><span>    revoke-token        Revoke cluster member join token
</span></span><span style="display:flex;"><span>    role                Manage cluster roles
</span></span><span style="display:flex;"><span>      add          Add roles to a cluster member
</span></span><span style="display:flex;"><span>      remove       Remove roles from a cluster member
</span></span><span style="display:flex;"><span>    set                 Set a cluster member&#39;s configuration keys
</span></span><span style="display:flex;"><span>    show                Show details of a cluster member
</span></span><span style="display:flex;"><span>    unset               Unset a cluster member&#39;s configuration keys
</span></span><span style="display:flex;"><span>    update-certificate  Update cluster certificate
</span></span><span style="display:flex;"><span>  config       Manage instance and server configuration options
</span></span><span style="display:flex;"><span>    device       Manage devices
</span></span><span style="display:flex;"><span>      add          Add instance devices
</span></span><span style="display:flex;"><span>      get          Get values for device configuration keys
</span></span><span style="display:flex;"><span>      list         List instance devices
</span></span><span style="display:flex;"><span>      override     Copy profile inherited devices and override configuration keys
</span></span><span style="display:flex;"><span>      remove       Remove instance devices
</span></span><span style="display:flex;"><span>      set          Set device configuration keys
</span></span><span style="display:flex;"><span>      show         Show full device configuration
</span></span><span style="display:flex;"><span>      unset        Unset device configuration keys
</span></span><span style="display:flex;"><span>    edit         Edit instance or server configurations as YAML
</span></span><span style="display:flex;"><span>    get          Get values for instance or server configuration keys
</span></span><span style="display:flex;"><span>    metadata     Manage instance metadata files
</span></span><span style="display:flex;"><span>      edit         Edit instance metadata files
</span></span><span style="display:flex;"><span>      show         Show instance metadata files
</span></span><span style="display:flex;"><span>    set          Set instance or server configuration keys
</span></span><span style="display:flex;"><span>    show         Show instance or server configurations
</span></span><span style="display:flex;"><span>    template     Manage instance file templates
</span></span><span style="display:flex;"><span>      create       Create new instance file templates
</span></span><span style="display:flex;"><span>      delete       Delete instance file templates
</span></span><span style="display:flex;"><span>      edit         Edit instance file templates
</span></span><span style="display:flex;"><span>      list         List instance file templates
</span></span><span style="display:flex;"><span>      show         Show content of instance file templates
</span></span><span style="display:flex;"><span>    trust        Manage trusted clients
</span></span><span style="display:flex;"><span>      add           Add new trusted client
</span></span><span style="display:flex;"><span>      edit          Edit trust configurations as YAML
</span></span><span style="display:flex;"><span>      list          List trusted clients
</span></span><span style="display:flex;"><span>      list-tokens   List all active certificate add tokens
</span></span><span style="display:flex;"><span>      remove        Remove trusted client
</span></span><span style="display:flex;"><span>      revoke-token  Revoke certificate add token
</span></span><span style="display:flex;"><span>      show          Show trust configurations
</span></span><span style="display:flex;"><span>    unset        Unset instance or server configuration keys
</span></span><span style="display:flex;"><span>  console      Attach to instance consoles
</span></span><span style="display:flex;"><span>  copy         Copy instances within or in between LXD servers
</span></span><span style="display:flex;"><span>  delete       Delete instances and snapshots
</span></span><span style="display:flex;"><span>  exec         Execute commands in instances
</span></span><span style="display:flex;"><span>  export       Export instance backups
</span></span><span style="display:flex;"><span>  file         Manage files in instances
</span></span><span style="display:flex;"><span>    delete       Delete files in instances
</span></span><span style="display:flex;"><span>    edit         Edit files in instances
</span></span><span style="display:flex;"><span>    mount        Mount files from instances
</span></span><span style="display:flex;"><span>    pull         Pull files from instances
</span></span><span style="display:flex;"><span>    push         Push files into instances
</span></span><span style="display:flex;"><span>  help         Help about any command
</span></span><span style="display:flex;"><span>  image        Manage images
</span></span><span style="display:flex;"><span>    alias           Manage image aliases
</span></span><span style="display:flex;"><span>      create       Create aliases for existing images
</span></span><span style="display:flex;"><span>      delete       Delete image aliases
</span></span><span style="display:flex;"><span>      list         List image aliases
</span></span><span style="display:flex;"><span>      rename       Rename aliases
</span></span><span style="display:flex;"><span>    copy            Copy images between servers
</span></span><span style="display:flex;"><span>    delete          Delete images
</span></span><span style="display:flex;"><span>    edit            Edit image properties
</span></span><span style="display:flex;"><span>    export          Export and download images
</span></span><span style="display:flex;"><span>    get-property    Get image properties
</span></span><span style="display:flex;"><span>    import          Import images into the image store
</span></span><span style="display:flex;"><span>    info            Show useful information about images
</span></span><span style="display:flex;"><span>    list            List images
</span></span><span style="display:flex;"><span>    refresh         Refresh images
</span></span><span style="display:flex;"><span>    set-property    Set image properties
</span></span><span style="display:flex;"><span>    show            Show image properties
</span></span><span style="display:flex;"><span>    unset-property  Unset image properties
</span></span><span style="display:flex;"><span>  import       Import instance backups
</span></span><span style="display:flex;"><span>  info         Show instance or server information
</span></span><span style="display:flex;"><span>  init         Create instances from images
</span></span><span style="display:flex;"><span>  launch       Create and start instances from images
</span></span><span style="display:flex;"><span>  list         List instances
</span></span><span style="display:flex;"><span>  manpage      Generate manpages for all commands
</span></span><span style="display:flex;"><span>  monitor      Monitor a local or remote LXD server
</span></span><span style="display:flex;"><span>  move         Move instances within or in between LXD servers
</span></span><span style="display:flex;"><span>  network      Manage and attach instances to networks
</span></span><span style="display:flex;"><span>    acl             Manage network ACLs
</span></span><span style="display:flex;"><span>      create       Create new network ACLs
</span></span><span style="display:flex;"><span>      delete       Delete network ACLs
</span></span><span style="display:flex;"><span>      edit         Edit network ACL configurations as YAML
</span></span><span style="display:flex;"><span>      get          Get values for network ACL configuration keys
</span></span><span style="display:flex;"><span>      list         List available network ACLS
</span></span><span style="display:flex;"><span>      rename       Rename network ACLs
</span></span><span style="display:flex;"><span>      rule         Manage network ACL rules
</span></span><span style="display:flex;"><span>        add          Add rules to an ACL
</span></span><span style="display:flex;"><span>        remove       Remove rules from an ACL
</span></span><span style="display:flex;"><span>      set          Set network ACL configuration keys
</span></span><span style="display:flex;"><span>      show         Show network ACL configurations
</span></span><span style="display:flex;"><span>      show-log     Show network ACL log
</span></span><span style="display:flex;"><span>      unset        Unset network ACL configuration keys
</span></span><span style="display:flex;"><span>    attach          Attach network interfaces to instances
</span></span><span style="display:flex;"><span>    attach-profile  Attach network interfaces to profiles
</span></span><span style="display:flex;"><span>    create          Create new networks
</span></span><span style="display:flex;"><span>    delete          Delete networks
</span></span><span style="display:flex;"><span>    detach          Detach network interfaces from instances
</span></span><span style="display:flex;"><span>    detach-profile  Detach network interfaces from profiles
</span></span><span style="display:flex;"><span>    edit            Edit network configurations as YAML
</span></span><span style="display:flex;"><span>    forward         Manage network forwards
</span></span><span style="display:flex;"><span>      create       Create new network forwards
</span></span><span style="display:flex;"><span>      delete       Delete network forwards
</span></span><span style="display:flex;"><span>      edit         Edit network forward configurations as YAML
</span></span><span style="display:flex;"><span>      get          Get values for network forward configuration keys
</span></span><span style="display:flex;"><span>      list         List available network forwards
</span></span><span style="display:flex;"><span>      port         Manage network forward ports
</span></span><span style="display:flex;"><span>        add          Add ports to a forward
</span></span><span style="display:flex;"><span>        remove       Remove ports from a forward
</span></span><span style="display:flex;"><span>      set          Set network forward keys
</span></span><span style="display:flex;"><span>      show         Show network forward configurations
</span></span><span style="display:flex;"><span>      unset        Unset network forward configuration keys
</span></span><span style="display:flex;"><span>    get             Get values for network configuration keys
</span></span><span style="display:flex;"><span>    info            Get runtime information on networks
</span></span><span style="display:flex;"><span>    list            List available networks
</span></span><span style="display:flex;"><span>    list-leases     List DHCP leases
</span></span><span style="display:flex;"><span>    peer            Manage network peerings
</span></span><span style="display:flex;"><span>      create       Create new network peering
</span></span><span style="display:flex;"><span>      delete       Delete network peerings
</span></span><span style="display:flex;"><span>      edit         Edit network peer configurations as YAML
</span></span><span style="display:flex;"><span>      get          Get values for network peer configuration keys
</span></span><span style="display:flex;"><span>      list         List available network peers
</span></span><span style="display:flex;"><span>      set          Set network peer keys
</span></span><span style="display:flex;"><span>      show         Show network peer configurations
</span></span><span style="display:flex;"><span>      unset        Unset network peer configuration keys
</span></span><span style="display:flex;"><span>    rename          Rename networks
</span></span><span style="display:flex;"><span>    set             Set network configuration keys
</span></span><span style="display:flex;"><span>    show            Show network configurations
</span></span><span style="display:flex;"><span>    unset           Unset network configuration keys
</span></span><span style="display:flex;"><span>    zone            Manage network zones
</span></span><span style="display:flex;"><span>      create       Create new network zones
</span></span><span style="display:flex;"><span>      delete       Delete network zones
</span></span><span style="display:flex;"><span>      edit         Edit network zone configurations as YAML
</span></span><span style="display:flex;"><span>      get          Get values for network zone configuration keys
</span></span><span style="display:flex;"><span>      list         List available network zoneS
</span></span><span style="display:flex;"><span>      record       Manage network zone records
</span></span><span style="display:flex;"><span>        create       Create new network zone record
</span></span><span style="display:flex;"><span>        delete       Delete network zone record
</span></span><span style="display:flex;"><span>        edit         Edit network zone record configurations as YAML
</span></span><span style="display:flex;"><span>        entry        Manage network zone record entries
</span></span><span style="display:flex;"><span>        get          Get values for network zone record configuration keys
</span></span><span style="display:flex;"><span>        list         List available network zone records
</span></span><span style="display:flex;"><span>        set          Set network zone record configuration keys
</span></span><span style="display:flex;"><span>        show         Show network zone record configuration
</span></span><span style="display:flex;"><span>        unset        Unset network zone record configuration keys
</span></span><span style="display:flex;"><span>      set          Set network zone configuration keys
</span></span><span style="display:flex;"><span>      show         Show network zone configurations
</span></span><span style="display:flex;"><span>      unset        Unset network zone configuration keys
</span></span><span style="display:flex;"><span>  operation    List, show and delete background operations
</span></span><span style="display:flex;"><span>    delete       Delete a background operation (will attempt to cancel)
</span></span><span style="display:flex;"><span>    list         List background operations
</span></span><span style="display:flex;"><span>    show         Show details on a background operation
</span></span><span style="display:flex;"><span>  pause        Pause instances
</span></span><span style="display:flex;"><span>  profile      Manage profiles
</span></span><span style="display:flex;"><span>    add          Add profiles to instances
</span></span><span style="display:flex;"><span>    assign       Assign sets of profiles to instances
</span></span><span style="display:flex;"><span>    copy         Copy profiles
</span></span><span style="display:flex;"><span>    create       Create profiles
</span></span><span style="display:flex;"><span>    delete       Delete profiles
</span></span><span style="display:flex;"><span>    device       Manage devices
</span></span><span style="display:flex;"><span>      add          Add instance devices
</span></span><span style="display:flex;"><span>      get          Get values for device configuration keys
</span></span><span style="display:flex;"><span>      list         List instance devices
</span></span><span style="display:flex;"><span>      remove       Remove instance devices
</span></span><span style="display:flex;"><span>      set          Set device configuration keys
</span></span><span style="display:flex;"><span>      show         Show full device configuration
</span></span><span style="display:flex;"><span>      unset        Unset device configuration keys
</span></span><span style="display:flex;"><span>    edit         Edit profile configurations as YAML
</span></span><span style="display:flex;"><span>    get          Get values for profile configuration keys
</span></span><span style="display:flex;"><span>    list         List profiles
</span></span><span style="display:flex;"><span>    remove       Remove profiles from instances
</span></span><span style="display:flex;"><span>    rename       Rename profiles
</span></span><span style="display:flex;"><span>    set          Set profile configuration keys
</span></span><span style="display:flex;"><span>    show         Show profile configurations
</span></span><span style="display:flex;"><span>    unset        Unset profile configuration keys
</span></span><span style="display:flex;"><span>  project      Manage projects
</span></span><span style="display:flex;"><span>    create       Create projects
</span></span><span style="display:flex;"><span>    delete       Delete projects
</span></span><span style="display:flex;"><span>    edit         Edit project configurations as YAML
</span></span><span style="display:flex;"><span>    get          Get values for project configuration keys
</span></span><span style="display:flex;"><span>    info         Get a summary of resource allocations
</span></span><span style="display:flex;"><span>    list         List projects
</span></span><span style="display:flex;"><span>    rename       Rename projects
</span></span><span style="display:flex;"><span>    set          Set project configuration keys
</span></span><span style="display:flex;"><span>    show         Show project options
</span></span><span style="display:flex;"><span>    switch       Switch the current project
</span></span><span style="display:flex;"><span>    unset        Unset project configuration keys
</span></span><span style="display:flex;"><span>  publish      Publish instances as images
</span></span><span style="display:flex;"><span>  query        Send a raw query to LXD
</span></span><span style="display:flex;"><span>  remote       Manage the list of remote servers
</span></span><span style="display:flex;"><span>    add          Add new remote servers
</span></span><span style="display:flex;"><span>    get-default  Show the default remote
</span></span><span style="display:flex;"><span>    list         List the available remotes
</span></span><span style="display:flex;"><span>    remove       Remove remotes
</span></span><span style="display:flex;"><span>    rename       Rename remotes
</span></span><span style="display:flex;"><span>    set-url      Set the URL for the remote
</span></span><span style="display:flex;"><span>    switch       Switch the default remote
</span></span><span style="display:flex;"><span>  rename       Rename instances and snapshots
</span></span><span style="display:flex;"><span>  restart      Restart instances
</span></span><span style="display:flex;"><span>  restore      Restore instances from snapshots
</span></span><span style="display:flex;"><span>  snapshot     Create instance snapshots
</span></span><span style="display:flex;"><span>  start        Start instances
</span></span><span style="display:flex;"><span>  stop         Stop instances
</span></span><span style="display:flex;"><span>  storage      Manage storage pools and volumes
</span></span><span style="display:flex;"><span>    create       Create storage pools
</span></span><span style="display:flex;"><span>    delete       Delete storage pools
</span></span><span style="display:flex;"><span>    edit         Edit storage pool configurations as YAML
</span></span><span style="display:flex;"><span>    get          Get values for storage pool configuration keys
</span></span><span style="display:flex;"><span>    info         Show useful information about storage pools
</span></span><span style="display:flex;"><span>    list         List available storage pools
</span></span><span style="display:flex;"><span>    set          Set storage pool configuration keys
</span></span><span style="display:flex;"><span>    show         Show storage pool configurations and resources
</span></span><span style="display:flex;"><span>    unset        Unset storage pool configuration keys
</span></span><span style="display:flex;"><span>    volume       Manage storage volumes
</span></span><span style="display:flex;"><span>      attach          Attach new storage volumes to instances
</span></span><span style="display:flex;"><span>      attach-profile  Attach new storage volumes to profiles
</span></span><span style="display:flex;"><span>      copy            Copy storage volumes
</span></span><span style="display:flex;"><span>      create          Create new custom storage volumes
</span></span><span style="display:flex;"><span>      delete          Delete storage volumes
</span></span><span style="display:flex;"><span>      detach          Detach storage volumes from instances
</span></span><span style="display:flex;"><span>      detach-profile  Detach storage volumes from profiles
</span></span><span style="display:flex;"><span>      edit            Edit storage volume configurations as YAML
</span></span><span style="display:flex;"><span>      export          Export custom storage volume
</span></span><span style="display:flex;"><span>      get             Get values for storage volume configuration keys
</span></span><span style="display:flex;"><span>      import          Import custom storage volumes
</span></span><span style="display:flex;"><span>      info            Show storage volume state information
</span></span><span style="display:flex;"><span>      list            List storage volumes
</span></span><span style="display:flex;"><span>      move            Move storage volumes between pools
</span></span><span style="display:flex;"><span>      rename          Rename storage volumes and storage volume snapshots
</span></span><span style="display:flex;"><span>      restore         Restore storage volume snapshots
</span></span><span style="display:flex;"><span>      set             Set storage volume configuration keys
</span></span><span style="display:flex;"><span>      show            Show storage volume configurations
</span></span><span style="display:flex;"><span>      snapshot        Snapshot storage volumes
</span></span><span style="display:flex;"><span>      unset           Unset storage volume configuration keys
</span></span><span style="display:flex;"><span>  version      Show local and remote versions
</span></span><span style="display:flex;"><span>  warning      Manage warnings
</span></span><span style="display:flex;"><span>    acknowledge  Acknowledge warning
</span></span><span style="display:flex;"><span>    delete       Delete warning
</span></span><span style="display:flex;"><span>    list         List warnings
</span></span><span style="display:flex;"><span>    show         Show warning
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Flags:
</span></span><span style="display:flex;"><span>      --all            Show less common commands
</span></span><span style="display:flex;"><span>      --debug          Show all debug messages
</span></span><span style="display:flex;"><span>      --force-local    Force using the local unix socket
</span></span><span style="display:flex;"><span>  -h, --help           Print help
</span></span><span style="display:flex;"><span>      --project        Override the source project
</span></span><span style="display:flex;"><span>  -q, --quiet          Don&#39;t show progress information
</span></span><span style="display:flex;"><span>      --sub-commands   Use with help or --help to view sub-commands
</span></span><span style="display:flex;"><span>  -v, --verbose        Show all information messages
</span></span><span style="display:flex;"><span>      --version        Print version number
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Use &#34;lxc [command] --help&#34; for more information about a command.
</span></span></code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>The <code>lxd</code> package offers <code>lxd</code> and <code>lxd-user</code> daemons with many subcommands for <code>lxd</code>.  Subcommand tool description tends to include &ldquo;low-level&rdquo;.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxd -h
</span></span><span style="display:flex;"><span>Description:
</span></span><span style="display:flex;"><span>  The LXD container manager (daemon)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  This is the LXD daemon command line. It&#39;s typically started directly by your
</span></span><span style="display:flex;"><span>  init system and interacted with through a tool like `lxc`.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  There are however a number of subcommands that let you interact directly with
</span></span><span style="display:flex;"><span>  the local LXD daemon and which may not be performed through the REST API alone.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Usage:
</span></span><span style="display:flex;"><span>  lxd [flags]
</span></span><span style="display:flex;"><span>  lxd [command]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Available Commands:
</span></span><span style="display:flex;"><span>  activateifneeded   Check if LXD should be started
</span></span><span style="display:flex;"><span>  cluster            Low-level cluster administration commands
</span></span><span style="display:flex;"><span>  help               Help about any command
</span></span><span style="display:flex;"><span>  import             Command has been replaced with &#34;lxd recover&#34;
</span></span><span style="display:flex;"><span>  init               Configure the LXD daemon
</span></span><span style="display:flex;"><span>  recover            Recover missing instances and volumes from existing and unknown storage pools
</span></span><span style="display:flex;"><span>  shutdown           Tell LXD to shutdown all containers and exit
</span></span><span style="display:flex;"><span>  version            Show the server version
</span></span><span style="display:flex;"><span>  waitready          Wait for LXD to be ready to process requests
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Flags:
</span></span><span style="display:flex;"><span>  -d, --debug     Show all debug messages
</span></span><span style="display:flex;"><span>      --group     The group of users that will be allowed to talk to LXD
</span></span><span style="display:flex;"><span>  -h, --help      Print help
</span></span><span style="display:flex;"><span>      --logfile   Path to the log file
</span></span><span style="display:flex;"><span>      --syslog    Log to syslog
</span></span><span style="display:flex;"><span>      --trace     Log tracing targets
</span></span><span style="display:flex;"><span>  -v, --verbose   Show all information messages
</span></span><span style="display:flex;"><span>      --version   Print version number
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Use &#34;lxd [command] --help&#34; for more information about a command.
</span></span></code></pre></div><p>Since I used this <code>init</code> subcommand, let&rsquo;s see:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxd init -h
</span></span><span style="display:flex;"><span>Description:
</span></span><span style="display:flex;"><span>  Configure the LXD daemon
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Usage:
</span></span><span style="display:flex;"><span>  lxd init [flags]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Examples:
</span></span><span style="display:flex;"><span>  init --minimal
</span></span><span style="display:flex;"><span>  init --auto [--network-address=IP] [--network-port=8443] [--storage-backend=dir]
</span></span><span style="display:flex;"><span>              [--storage-create-device=DEVICE] [--storage-create-loop=SIZE]
</span></span><span style="display:flex;"><span>              [--storage-pool=POOL] [--trust-password=PASSWORD]
</span></span><span style="display:flex;"><span>  init --preseed
</span></span><span style="display:flex;"><span>  init --dump
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Flags:
</span></span><span style="display:flex;"><span>      --auto                    Automatic (non-interactive) mode
</span></span><span style="display:flex;"><span>      --dump                    Dump YAML config to stdout
</span></span><span style="display:flex;"><span>      --minimal                 Minimal configuration (non-interactive)
</span></span><span style="display:flex;"><span>      --network-address         Address to bind LXD to (default: none)
</span></span><span style="display:flex;"><span>      --network-port            Port to bind LXD to (default: 8443) (default -1)
</span></span><span style="display:flex;"><span>      --preseed                 Pre-seed mode, expects YAML config from stdin
</span></span><span style="display:flex;"><span>      --storage-backend         Storage backend to use (btrfs, dir, lvm or zfs, default: dir)
</span></span><span style="display:flex;"><span>      --storage-create-device   Setup device based storage using DEVICE
</span></span><span style="display:flex;"><span>      --storage-create-loop     Setup loop based storage with SIZE in GB (default -1)
</span></span><span style="display:flex;"><span>      --storage-pool            Storage pool to use or create
</span></span><span style="display:flex;"><span>      --trust-password          Password required to add new clients
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Global Flags:
</span></span><span style="display:flex;"><span>  -d, --debug     Show all debug messages
</span></span><span style="display:flex;"><span>  -h, --help      Print help
</span></span><span style="display:flex;"><span>      --logfile   Path to the log file
</span></span><span style="display:flex;"><span>      --syslog    Log to syslog
</span></span><span style="display:flex;"><span>      --trace     Log tracing targets
</span></span><span style="display:flex;"><span>  -v, --verbose   Show all information messages
</span></span><span style="display:flex;"><span>      --version   Print version number
</span></span></code></pre></div><p>I also see another command in this package.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span> $ lxd-user -h
</span></span><span style="display:flex;"><span>Description:
</span></span><span style="display:flex;"><span>  LXD user project daemon
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  This daemon is used to allow users that aren&#39;t considered to be LXD
</span></span><span style="display:flex;"><span>  administrators access to a personal LXD project with suitable
</span></span><span style="display:flex;"><span>  restrictions.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Usage:
</span></span><span style="display:flex;"><span>  lxd-user [flags]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Flags:
</span></span><span style="display:flex;"><span>  -h, --help      Print help
</span></span><span style="display:flex;"><span>      --version   Print version number
</span></span></code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>The <code>lxd-tools</code> package offers extra tools for <code>lxd</code>.
<ul>
<li><code>fuidshift</code>(1)</li>
<li><code>lxc-to-lxd</code>(1)</li>
<li><code>lxd-benchmark</code>(1)</li>
</ul>
</li>
<li>The <code>lxc</code> package offers many hyphenated <code>lxc-*</code> commands for low-level Linux Containers userspace tools.
<ul>
<li>This doesn&rsquo;t include <code>lxc</code> command.</li>
<li>It looks like we should indirectly access these functionalities using <code>lxc</code> commands which seems to take care some other things.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="references-container-landscape-essays">References: Container landscape essays</h2>
<ul>
<li><a href="https://lwn.net/Articles/531114/">Namespaces in operation</a> January 4, 2013 &ndash; series index up to June 15, 2016</li>
<li><a href="https://lwn.net/Articles/679786/">Understanding the new control groups API</a> March 23, 2016</li>
<li><a href="https://www.sokube.io/blog/the-kubernetes-containers-runtime-jungle">The Kubernetes Containers runtime jungle</a> November 9, 2019</li>
<li><a href="https://discuss.linuxcontainers.org/t/lxc-5-0-lts-has-been-released/14381">LXC 5.0 LTS has been released</a> June, 2022</li>
<li><a href="https://lwn.net/Articles/902049/">Docker and the OCI container ecosystem</a> July 26, 2022</li>
<li><a href="https://lwn.net/Articles/905164/">The container orchestrator landscape</a> August 23, 2022</li>
<li><a href="https://lwn.net/Articles/907613/">LXC and LXD: a different container story</a> September 13, 2022</li>
<li><a href="https://lwn.net/Articles/909627/">Progress for unprivileged containers</a> September 28, 2022</li>
<li><a href="https://www.ionos.com/digitalguide/server/know-how/podman-vs-docker/">Summary: Podman vs. Docker – will Podman fill Docker’s shoes?</a> 11/30/2022</li>
<li><a href="https://linuxcontainers.org/lxd/">LXD is now under Canonical</a> July 4, 2023</li>
<li><a href="https://linuxcontainers.org/incus/">What is Incus?</a>
<ul>
<li><a href="https://linuxcontainers.org/incus/announcement/">Introducing Incus</a> August 7, 2023</li>
</ul>
</li>
<li><a href="https://zenn.dev/ttnt_1013/articles/f36e251a0cd24e">Docker一強の終焉にあたり、押さえるべきContainer事情</a> 2023/04/03 (rev.2023/05/01)
<ul>
<li><a href="https://mkdev.me/posts/dockerless-part-1-which-tools-to-replace-docker-with-and-why">Series &ldquo;Dockerless&rdquo; by mkdev</a> (2023?)</li>
</ul>
</li>
<li><a href="https://news.ycombinator.com/item?id=36595183#:~:text=Podman%20is%20meant%20to%20run%20'application%20containers'%2C%20where%20each,and%20(possibly)%20multiple%20daemons.">Hacker News: LXD isn&rsquo;t an alternative to podman</a> 2023-07-05
<ul>
<li>Podman is meant to run &lsquo;application containers&rsquo;, where each container has just one running process.</li>
<li>LXD is meant to run &lsquo;system containers&rsquo; where each container is a full Linux distribution with an init system and (possibly) multiple daemons.
<ul>
<li>LXD containers are like light-weight VMs. Unlike VMs, LXD containers share the host kernel.</li>
</ul>
</li>
<li>You could run podman or other OCI containers inside LXD. I use LXD to test multi node K8s (K3s) on my desktop system.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2023/10/07/debian-usability-2023a/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="/en/2023/10/20/network-1/">Next Post</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  © 2013-2024 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>


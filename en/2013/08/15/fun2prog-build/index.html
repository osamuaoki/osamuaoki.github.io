<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fun to Program -- Build system | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Fun to Program &ndash; Build system</span></h1>

<h3 class="date">Date:
2013/08/15 (initial publish),
2021/08/02 (last update)
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2013/08/14/fun2prog-python/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="/en/2013/08/16/fun2prog-gnome/">Next Post</a></td>
  
  </tr>
  </tbody>
</table>

<h2>TOC</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#build-system">Build system</a>
      <ul>
        <li><a href="#autotools">Autotools</a></li>
        <li><a href="#cmake">CMake</a></li>
      </ul>
    </li>
  </ul>
</nav>

<blockquote>
<p>This was originally written and created around 2013 and may require to be
updated. (2021)</p>
</blockquote>
<h2 id="build-system">Build system</h2>
<p>There are many cross-platform build systems:</p>
<ul>
<li><a href="#autotools">Autotools</a> for GNU, GNOME, generic C/C++/Vala/&hellip; programs</li>
<li><a href="/#cmake">CMake</a> for KDE programs, etc.</li>
<li>Python <code>distutils</code> for some Python programs
<ul>
<li><a href="/en/2013/08/14/fun2prog-python/#install-python-source-distribution">Install Python source distribution</a> (as a user)</li>
<li><a href="/en/2013/08/14/fun2prog-python/#generate-python-source-distribution">Generate Python source distribution</a> (as an upstream)</li>
</ul>
</li>
</ul>
<p>Please note there are many programs which come with the plain GNU Make as the
build system .  The plain GNU Make is simple and works fairly well across all
modern Unix-like systems.</p>
<h3 id="autotools">Autotools</h3>
<p>This is the most versatile and robust build system.</p>
<ul>
<li><a href="http://www.gnu.org/software/automake/manual/html_node/Autotools-Introduction.html">An Introduction to the Autotools</a>
<ul>
<li><a href="http://www.gnu.org/software/automake/manual/html_node/GNU-Build-System.html">Introducing the GNU Build System</a></li>
<li><a href="http://www.gnu.org/software/automake/manual/html_node/Use-Cases.html">Use Cases for the GNU Build System</a></li>
<li><a href="http://www.gnu.org/software/automake/manual/html_node/Why-Autotools.html">Why Autotools</a></li>
<li><a href="http://www.gnu.org/software/automake/manual/html_node/Hello-World.html">A Small Hello World</a></li>
</ul>
</li>
<li><a href="http://www.lrde.epita.fr/~adl/autotools.html">Autotools Tutorial</a></li>
</ul>
<p>The internal of Autotools are beyond my taste for learning. (Yack! What a convoluted use of <a href="http://en.wikipedia.org/wiki/M4_(computer_language)">GNU m4</a> for such complicated tasks.)</p>
<p>But compared to other newer build systems, I would rather use Autotools.  This is because:  &ldquo;better the devil you know than the devil you don&rsquo;t know.&rdquo;</p>
<h4 id="as-a-user">As a user</h4>
<p>The source package generated by the Autotools (= Autoconf + Automake + &hellip;)
requires only basic tools available on any Debian systems:</p>
<ul>
<li>Bourne shell (Dash)</li>
<li>Sed</li>
<li>Make</li>
</ul>
<p>As a user, you only deal with files such as <code>configure</code> and <code>Makefile.in</code>
generated by the Autotools.  There is no need for any specialized external
tools such as GNU M4 nor Perl nor Autotools.</p>
<p>They can be build as follows:</p>
<pre><code>$ ./configure
..
$ make
..
$ sudo make install
</code></pre><p>The schematic relationship can be visualized as:</p>
<pre><code>program.c --------------------------------------\
program.h --------------------------------------+--[make]--&gt; program    
config.h.in --\                 /--&gt; config.h --/    /
Makefile.in --+--[./configure]--+--&gt; Makefile ------+
</code></pre><p>TIP: The above build process is true not just for source packages generated by
the Autotools but for many other source packages.</p>
<p>Here, the template files such as <code>Makefile.in</code> and <code>config.h.in</code>  have embedded
strings such as <code>@CC@</code> and <code>@prefix@</code> and they are replaced by the name of the
particular C compiler and the installation directory using the Sed program
executed from the <code>configure</code> script.  It is good idea not to mess with these
directly to customize your package build process.</p>
<p>Instead, you have 2 basic ways to customize your package build process as a
user.</p>
<ul>
<li>Run the <code>configure</code> shell script with options.</li>
<li>Run the <code>make</code> command with options and environment variables.</li>
</ul>
<p>As for the <code>configure</code> options, you get their good explanation as follows:</p>
<pre><code>$ ./configure -h
</code></pre><p>You should check all available command line options displayed.  This is because
the <code>configure</code> script is meant to be run non-interactively.</p>
<p>As for the <code>make</code> command, since the <code>Makefile</code> generated by the Autotools
follows GNU coding standards, please read &ldquo;Makefile Conventions&rdquo; in the
<a href="http://www.gnu.org/prep/standards/html_node/index.html">GNU coding standards</a> to
learn how to change behavior of <code>make</code>.</p>
<p>TIP: The default installation destination is <code>/usr/local</code>.</p>
<h4 id="as-an-upstream">As an upstream</h4>
<p>Autotools (= Autoconf + Automake + &hellip;) is a tool to create the portable source
package with minimal efforts.  It is not easy to make portable across different
platforms.  It generates a good set of <code>configure</code>, <code>Makefile.in</code> and
<code>config.h.in</code> required for a source package from simple data in the
<code>configure.ac</code> and <code>Makefile.am</code> files using the <code>autoreconf -i</code> command which
runs all the Autotools in the right sequences.</p>
<pre><code>program.c--------------+
program.h--------------+
configure.ac --+       |           +--&gt; configure----------V
               +--[autoreconf -i]--+--&gt; config.h.in --[./configure]--&gt; config.h
Makefile.am  --+                   +--&gt; Makefile.in --[./configure]--&gt; Makefile
</code></pre><ul>
<li><code>configure.ac</code> is the primarily configuration file to create <code>configure</code> by the Autoconf:
<ul>
<li>The Autoconf is a M4 macro program with many pre-defined macros.</li>
<li>M4 macro quotes used by the Autoconf is changed to <code>[</code> <code>]</code>.</li>
<li>M4 macro strings in <code>configure.ac</code> are substituted by the Autoconf.</li>
<li><code>configure.ac</code> can contain shell codes and they remain in <code>configure</code> as is.</li>
</ul>
</li>
<li><code>Makefile.am</code> is the primarily configuration file to create <code>Makefile.in</code> by the Automake:
<ul>
<li>The Automake is a Perl program.</li>
<li><code>Makefile.am</code> defines the specific variable names and their values to denote source files and their generated files.</li>
<li>Generated build dependencies are defined as suffix rules.</li>
<li><code>Makefile.am</code> can contain Makefile snippets and remains in <code>Makefile</code> as is.</li>
</ul>
</li>
<li><code>Makefile</code> is generated from <code>Makefile.in</code> using <code>configure</code> by a user.
<ul>
<li><code>configure</code> is a portable shell program.</li>
<li><code>Makefile.in</code> is the <code>Makefile</code> template.</li>
</ul>
</li>
</ul>
<p>Suppose you have <code>hello.c</code>.</p>

<pre><code>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &#34;config.h&#34;
main()
{
    printf(&#34;Hello, world! version: %s\n&#34;, VERSION);
    return EXIT_SUCCESS;
}
</code></pre>

<p>Then run <code>autoscan</code> to generate initial template of <code>configure.ac</code> and edit it
manually to the shape.</p>

<pre><code>$ autoscan
configure.ac: warning: missing AC_CHECK_HEADERS([stdlib.h]) wanted by: hello.c:1
$ mv configure.scan configure.ac
$ vim configure.ac
</code></pre>

<p>Since strict GNU compliance is not easy, lets make this as a &ldquo;foreign&rdquo; package
to avoid complication:</p>

<pre><code>#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.69])
AC_INIT([hello], [0.1], [osamu@debian.org])
AC_CONFIG_SRCDIR([config.h.in])
AC_CONFIG_HEADERS([config.h])

# Manually added
AM_INIT_AUTOMAKE([foreign])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

AC_CONFIG_FILES([Makefile])
AC_OUTPUT
</code></pre>

<p><code>Makefile.am</code> defines programs to be built and relationship of source files in very simple way as.</p>

<pre><code>bin_PROGRAMS = hello
hello_SOURCES = hello.c
</code></pre>

<p>Here:</p>
<ul>
<li>List binary program names as the value of <code>bin_PROGRAMS</code>.</li>
<li>List source file names for <code>hello</code> as the value of <code>hello_SOURCES</code>.</li>
</ul>

<pre><code>$ ls
configure.ac
hello.c
Makefile.am
</code></pre>

<p>Let&rsquo;s generate <code>configure</code>,  <code>Makefile.in</code> and <code>config.h.in</code> using <code>autoreconf -i -v -f</code> (<code>-f</code> option is needed only when you are running this command second
time.  <code>-v</code> is for verbose output.):</p>

<pre><code>$ autoreconf -i -v -f
autoreconf: Entering directory `.&#39;
autoreconf: configure.ac: not using Gettext
autoreconf: running: aclocal --force
autoreconf: configure.ac: tracing
autoreconf: configure.ac: not using Libtool
autoreconf: running: /usr/bin/autoconf --force
autoreconf: running: /usr/bin/autoheader --force
autoreconf: running: automake --add-missing --copy --force-missing
configure.ac:10: installing &#39;./install-sh&#39;
configure.ac:10: installing &#39;./missing&#39;
Makefile.am: installing &#39;./depcomp&#39;
autoreconf: Leaving directory `.&#39;
</code></pre>

<p>Let&rsquo;s make <code>./configure</code> to change the binary program destination from
<code>/usr/local/bin</code> to <code>/usr/bin</code> and to change the entire install destination
from <code>/</code> to <code>./tmp</code> for use by the binary distribution package build.  Then
let&rsquo;s run it from <code>./tmp/usr/bin/hello</code>.</p>

<pre><code>$ ./configure --prefix=/usr
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for style of include used by make... GNU
checking dependency style of gcc... gcc3
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: creating config.h
config.status: executing depfiles commands
$ make
make[5]: Entering directory `/path/to/hello&#39;
make  all-am
make[6]: Entering directory `/path/to/hello&#39;
gcc -DHAVE_CONFIG_H -I.     -g -O2 -MT hello.o -MD -MP -MF .deps/hello.Tpo -c -o ...
mv -f .deps/hello.Tpo .deps/hello.Po
gcc  -g -O2   -o hello hello.o
make[6]: Leaving directory `/path/to/hello&#39;
make[5]: Leaving directory `/path/to/hello&#39;
$ DESTDIR=./debian/tmp make install
make[5]: Entering directory `/path/to/hello&#39;
make[6]: Entering directory `/path/to/hello&#39;
 /bin/mkdir -p &#39;./debian/tmp/usr/bin&#39;
  /usr/bin/install -c hello &#39;./debian/tmp/usr/bin&#39;
make[6]: Nothing to be done for `install-data-am&#39;.
make[6]: Leaving directory `/path/to/hello&#39;
make[5]: Leaving directory `/path/to/hello&#39;
$ # now run it
$ ./debian/tmp/usr/bin/hello
Hello, world! version: 0.1
</code></pre>

<p>For more, <a href="http://www.lrde.epita.fr/~adl/dl/autotools.pdf">Using GNU Autotools</a></p>
<p>TIP: If you find <code>configure.in</code> instead of <code>configure.ac</code> in the source tree,
the source is very old.  It is good idea to update the configuration files to
match newer versions of the Autotools.</p>
<p>TIP: You should commit only hand-edited files to the upstream VCS.  For
Autotools, these are <code>configure.ac</code>, <code>Makefile.am</code>, <code>*/Makefile.am</code>, <code>AUTHORS</code>,
and <code>NEWS</code>(optional).  Do not bother to track other generated files.</p>
<p>See :</p>
<ul>
<li><a href="http://www.lrde.epita.fr/~adl/dl/autotools.pdf">Using GNU Autotools</a>
by A. Duret-Lutz (Tutorial)</li>
<li><a href="http://www.dwheeler.com/autotools/introduction-autotools.pdf">Introduction to the autotools (autoconf, automake, and libtool)</a> by David A. Wheeler (Tutorial)</li>
<li><a href="http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/index.html">GNU Autoconf manual (html)</a>, <a href="http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/autoconf.pdf">GNU Autoconf manual (PDF)</a></li>
<li><a href="http://www.gnu.org/software/automake/manual/automake.html">GNU Automake manual (html)</a>, <a href="http://www.gnu.org/software/automake/manual/automake.pdf">GNU Automake manual (PDF)</a></li>
</ul>
<h3 id="cmake">CMake</h3>
<p>XXX_FIXME_XXX</p>
<ul>
<li><a href="http://www.cmake.org/">http://www.cmake.org/</a></li>
<li><a href="http://www.cmake.org/cmake/help/cmake_tutorial.html">CMake Tutorial</a></li>
<li>Set <code>CMakeLists</code> file.</li>
</ul>
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2013/08/14/fun2prog-python/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="/en/2013/08/16/fun2prog-gnome/">Next Post</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  © 2013-2021 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>


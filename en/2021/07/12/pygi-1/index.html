<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GTK GUI with PyGObject (1) | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">GTK GUI with PyGObject (1)</span></h1>

<h3 class="date">Date:
2021/07/12 (initial publish),
2021/07/13 (last update)
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2021/04/09/dev-02/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

<h2 id="gtk-gui-situation">GTK GUI situation</h2>
<p>GTK3 GUI has been changing.  (Now 3.38.5)</p>
<p><a href="https://python-gtk-3-tutorial.readthedocs.io/en/latest/menus.html">The Python GTK+ 3 Tutorial</a>
(as of 2021-07) goes as:</p>
<blockquote>
<p>Gtk.UIManager, Gtk.Action, and Gtk.ActionGroup have been deprecated since
GTK+ version 3.10 and should not be used in newly-written code. Use the
Application framework instead.</p>
</blockquote>
<p>I understand this is caused by
<a href="https://gitlab.gnome.org/GNOME/Initiatives/-/wikis/App-Menu-Retirement">App Menu Retirement</a>.
I see no Python based tutorial contents for creating modern
<a href="https://developer.gnome.org/hig/stable/primary-menus.html.en">Primary menu</a>
etc.  How do I do it?
Unfortunately, many code examples
in the upstream source tree and the tutorial tend to contain old deprecated
practices.</p>
<p>I would like to use Glade with the Gtk.Builder class to program GUI with
minimum efforts instead of calling widget classes.</p>
<h2 id="glade">Glade</h2>
<p>Let me go step-by-step to use Glade to create GTK GUI.</p>
<p>In order to understand what each Glade component does, linked pages from the
corresponding listed classes in the Gtk 3.0&rsquo;s
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/class.html">Class</a> page was
valuable and gave me the most current insights.</p>
<p>Each Glade component is spelled without &ldquo;.&rdquo; while corresponding Gtk class name
has &ldquo;.&rdquo; after &ldquo;<strong>Gtk</strong>&rdquo;.</p>
<h3 id="where-to-start-gui">Where to start GUI</h3>
<p>Looking at the way Glade is designed, it looked like I should start creating
window design by clicking and moving item from selection in the top buttons to
the canvas.</p>
<p>Since I want a simple GUI,
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Window.html">GtkWindow</a>
found under the &ldquo;Toplevels&rdquo; button seems to be a good one as the starting
object.  (For other items under the &ldquo;Toplevels&rdquo; button, they seem to offer
mostly pop-up window dialogue etc.  One exeption is
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/ApplicationWindow.html">GtkApplicationWindow</a>
which accommodates capability to start program via DBus connection.)</p>
<p>How to create top bar embedded primary menu was tricky.  It looks like
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/HeaderBar.html">GtkHeaderBar</a>
under the &ldquo;Containers&rdquo; button is the one.   To me, this should have been placed
under the &ldquo;Toplevels&rdquo; button. (I am using Glade 3.38.2)</p>
<p>Please note
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/MenuBar.html">GtkMenuBar</a>
is not the one to use (marked as deprecated).</p>
<h3 id="how-to-fill-widgets-into-gui">How to fill widgets into GUI</h3>
<p>Dividing area into smaller subdivided areas are mostly done by
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Box.html">GtkBox</a>
or
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Grid.html">GtkGrid</a>
under the &ldquo;Containers&rdquo; button.</p>
<p>As a starter, I put
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Box.html">GtkBox</a>
and changed &ldquo;Number of items&rdquo; on the left panel to 7.</p>
<p>Then I placed
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Button.html">GtkButton</a>,
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Entry.html">GtkEntry</a>,
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/SearchEntry.html">GtkSearchEntry</a>,
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/SpinButton.html">GtkSpinButton</a>,
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Label.html">GtkLabel</a>,
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/TextView.html">GtkTextView</a>, and
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/FileChooserButton.html">GtkFileChooserButton</a>
as an easy starter.</p>
<p>For
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Window.html">GtkWindow</a>,
clicking composite box next to ID entry box will change &ldquo;ID&rdquo; to &ldquo;Class Name&rdquo;.
Let&rsquo;s put &ldquo;SimpleGui&rdquo; to &ldquo;ID&rdquo; or &ldquo;Class Name&rdquo; entry and see the difference in
XML.  Let&rsquo;s see the diff.</p>
<pre><code>--- composite-off-ID.ui 2021-07-12 22:56:06.250484181 +0900
+++ composite-on-class.ui       2021-07-12 22:54:35.185207274 +0900
@@ -2,7 +2,7 @@
 &lt;!-- Generated with glade 3.38.2 --&gt;
 &lt;interface&gt;
   &lt;requires lib=&quot;gtk+&quot; version=&quot;3.24&quot;/&gt;
-  &lt;object class=&quot;GtkWindow&quot; id=&quot;SimpleGui&quot;&gt;
+  &lt;template class=&quot;SimpleGui&quot; parent=&quot;GtkWindow&quot;&gt;
     &lt;property name=&quot;can-focus&quot;&gt;False&lt;/property&gt;
     &lt;child&gt;
       &lt;object class=&quot;GtkBox&quot;&gt;
@@ -95,5 +95,5 @@
         &lt;/child&gt;
       &lt;/object&gt;
     &lt;/child&gt;
-  &lt;/object&gt;
+  &lt;/template&gt;
 &lt;/interface&gt;
</code></pre><p>I set IDs for other widgets.</p>
<p>Hmm&hellip; I see.  Now, I can use decorator technique described in
<a href="https://python-gtk-3-tutorial.readthedocs.io/en/latest/builder.html#gtk-template">The Python GTK+ 3 Tutorial: 22.5.  Gtk.Template</a>.
This <strong>Gtk.Template</strong> can&rsquo;t be found in
<a href="https://lazka.github.io/pgi-docs/Gtk-3.0/classes.html">PyGObject API Reference under Gtk 3.0 » Classes</a>.
I found the definition of this decorator in the <strong>python3-gi</strong> package as
<code>/usr/lib/python3/dist-packages/gi/_gtktemplate.py</code> imported from
<code>/usr/lib/python3/dist-packages/gi/overrides/Gtk.py</code>.</p>
<p>Let&rsquo;s set the signal for the top level &ldquo;SimpleGui&rdquo; panel.  On right side panel
under &ldquo;signal&rdquo;, go down to &ldquo;GtkWidget&rdquo; and then we enter &ldquo;onDestroy&rdquo; asthe
&ldquo;destroy&rdquo; signal handler.  For &ldquo;button_example&rdquo; widget, we enter
&ldquo;onButtonPressed&rdquo; as the &ldquo;pressed&rdquo; signal handler.  For &ldquo;folder_example&rdquo;
created by &ldquo;GtkFileChooserButton&rdquo;, we enter
&ldquo;onFolderSelected&rdquo; as the &ldquo;selection-changed&rdquo; signal handler.</p>
<p><img src="/img/simple-gui-glade.png" alt="The Glade screen"></p>
<h3 id="how-to-create-gui-program">How to create GUI program</h3>
<p>Now we should be ready to use this from <code>simple.py</code>:</p>
<pre><code>import gi

gi.require_version(&quot;Gtk&quot;, &quot;3.0&quot;)
from gi.repository import Gtk


@Gtk.Template(filename=&quot;composite-on-class.ui&quot;)
class Window1(Gtk.Window):
    __gtype_name__ = &quot;SimpleGui&quot;

    @Gtk.Template.Callback()
    def onDestroy(self, *args):
        Gtk.main_quit()

    @Gtk.Template.Callback()
    def onButtonPressed(self, button):
        print(&quot;Hello World! &quot; + button.get_label())

    @Gtk.Template.Callback()
    def onFolderSelected(self, widget):
        print(&quot;Folder: &quot; + widget.get_filename())

window = Window1()
window.show()

Gtk.main()
</code></pre><p>Running this with <code>python3 simple.py</code> will start the GUI as:</p>
<p><img src="/img/simple-gui-run.png" alt="Run simple-gui"></p>
<p>Not bad.  I am using signal handler which uses the call back function.</p>
<p>For fixed GUI component widgets, this is going to be similar.</p>
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2021/04/09/dev-02/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  © 2019-2020 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>


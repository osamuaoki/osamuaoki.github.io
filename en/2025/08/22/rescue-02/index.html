<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rescue media(2) | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Rescue media(2)</span></h1>

<h3 class="date">Date:
2025/08/22 (initial publish),
2025/08/22 (last update)
</h3>
<h3 class="source">Source:
note-00079
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2025/04/24/python3-polib/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

<h2>TOC</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#rescue-media">Rescue media</a></li>
    <li><a href="#ventoy--gparted">Ventoy + Gparted</a></li>
    <li><a href="#booting-system">Booting system</a></li>
    <li><a href="#use-case-migrating-from-ext4-to-btrfs-for-home">Use case: Migrating from ext4 to Btrfs for home</a></li>
  </ul>
</nav>

<p>This is updated memo of <a href="/jp/2020/05/30/rescue-01/">Rescue media(1)</a>  (in Japanese).</p>
<h2 id="rescue-media">Rescue media</h2>
<p>There are many iso images which are useful for system administration and rescue
tasks available on the web.  Here are some of the notable ones:</p>
<ul>
<li><a href="https://gparted.org/livecd.php">GParted live</a>
<ul>
<li>GOOD: active</li>
<li>GOOD: Debian based system rescue media.</li>
<li>GOOD: GUI partition manager</li>
<li>BAD: Currently, Debian Lacks GUI LVM manager like <a href="https://github.com/storaged-project/blivet-gui">blivet-gui</a>
<ul>
<li>TODO: Follow <a href="https://gparted.org/create-gparted-live.php">Create GParted live from scratch</a> to install <a href="https://software.opensuse.org/download.html?project=home:vtrefny&amp;package=blivet-gui">blivet-gui deb pakage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://www.debian.org/distrib/netinst">debian-installer (netinst)</a>
<ul>
<li>GOOD: active and stable</li>
<li>GOOD: This facilitates official Debian system install.</li>
<li>BAD: &ldquo;rescue mode&rdquo; needs to mount a functioning root filesystem and it can&rsquo;t
be unmounted for filesystem operation (fsck&hellip;).</li>
</ul>
</li>
<li><a href="https://www.debian.org/CD/live/index.en.html">Debian live</a>
<ul>
<li>GOOD: active</li>
</ul>
</li>
<li><a href="https://www.debian.org/CD/live/index.en.html">Debian live</a>
<ul>
<li>GOOD: active</li>
<li>GOOD: Debian based system rescue media.</li>
</ul>
</li>
<li><a href="https://www.kali.org/get-kali/#kali-live">Kali Linux Live image </a>
<ul>
<li>GOOD: active</li>
<li>GOOD: Debian based system rescue media.</li>
</ul>
</li>
<li><a href="https://www.system-rescue.org/">SYSTEM RESCUE HOMEPAGE</a>
<ul>
<li>GOOD: active</li>
<li>FAIR: ARCHlinux based system rescue media</li>
</ul>
</li>
<li><a href="https://www.supergrubdisk.org/super-grub2-disk/">Super Grub2 Disk</a>/<a href="https://www.supergrubdisk.org/rescatux/">Rescatux</a>
<ul>
<li>GOOD: last release 2024 for <a href="https://www.supergrubdisk.org/super-grub2-disk/">Super Grub2 Disk</a> (the multi disk/iso boot loader, now support btrfs)</li>
<li>BAD: last released in 2021 for <a href="https://www.supergrubdisk.org/rescatux/">Rescatux</a> (outdated linux iso image)</li>
</ul>
</li>
<li><a href="https://www.ventoy.net/en/index.html">Ventoy</a>
<ul>
<li>GOOD: active (the multi disk/iso boot loader w/o iso image)</li>
</ul>
</li>
</ul>
<h2 id="ventoy--gparted">Ventoy + Gparted</h2>
<p>Since modern USB-keys have huge storage space, I decided to use
<a href="https://www.ventoy.net/en/index.html">ventoy</a> and put all interesting iso
images in it. This way, I only need to maintain one USB key.</p>
<p>For the moment, I will mostly use Gparted live iso image.</p>
<h2 id="booting-system">Booting system</h2>
<ul>
<li>Sony Vaio: power up system with a USB key inserted with &ldquo;ASSIST&rdquo; button.</li>
<li>Thinkpad T14 Gen 1 (AMD): power up and press ENTER or F12</li>
</ul>
<h2 id="use-case-migrating-from-ext4-to-btrfs-for-home">Use case: Migrating from ext4 to Btrfs for home</h2>
<p>Let&rsquo;s think about encrypted LVM install case where <code>/dev/sda</code> holds LVM <code>root, </code>home<code>, and </code>swap_1<code>.  Let's convert </code>home` data to use btrfs instead of ext4.</p>
<ul>
<li>Boot from USB to use rescue boot shell
<ul>
<li>Decrypt LUKS partion (<code>/dev/sda5</code>)
<ul>
<li><code>sudo cryptosetup luksOpen /dev/sda5 sda5_crypt</code></li>
<li>Now you see <code>/dev/mapper/hastname--vg-home</code>, <code>/dev/mapper/hastname--vg-root</code> etc.</li>
<li>Mount <code>/dev/mapper/hastname--vg-home</code> to <code>mnt/home</code></li>
<li>Mount <code>/dev/mapper/hastname--vg-root</code> to <code>/mnt/root</code></li>
</ul>
</li>
<li>Copy all data from <code>/mnt/home/username</code> to <code>/mnt/root/home/</code>.</li>
<li>Remove mounting of <code>hostname--vg-home</code> iin <code>/etc/fstab</code> by adding <code>#</code> at the head of line..</li>
</ul>
</li>
<li>Boot normal SSD system
<ul>
<li>Install required program
<ul>
<li><code>sudo apt install btrfs-progs</code></li>
</ul>
</li>
<li>Format forcebly the old <code>home</code> LV as btrfs
<ul>
<li><code>sudo mkfs.btrfs -f /dev/mapper/hostname--vg-home</code></li>
</ul>
</li>
<li>Check LV and VG names with <code>lvs</code> and <code>vgs</code></li>
<li>Rename the old <code>home</code> LV to <code>btrfs</code> LV
<ul>
<li><code>sudo lvrename hostname-vg home btrfs</code></li>
</ul>
</li>
<li>Mount <code>/dev/mapper/hostname--vg-btrfs</code> at <code>/mnt</code>
<ul>
<li><code>sudo mount /dev/mapper/hostname--vg-btrfs /mnt</code></li>
</ul>
</li>
<li>Create subvolume <code>@home</code> at <code>/mnt</code>
<ul>
<li><code>sudo btrfs subvolume create @home /mnt</code></li>
</ul>
</li>
<li>Copy back data under <code>/home</code> to <code>/mnt/@home</code>.</li>
<li>Change mounting of home in <code>/etc/fstab</code> to use <code>@home</code>-subvolume for home.
<ul>
<li>Add <code>/dev/mapper/hostname--vg-btrfs btrfs default,subvol=@home 0 2</code> in <code>/etc/fstab</code></li>
</ul>
</li>
<li>Reboot</li>
</ul>
</li>
</ul>
<p>NOTE: Use <code>pvs</code>, <code>vgs</code>, <code>lvs</code>,and <code>lvmdiskscan</code> commands to assess LVM
situation.  These are <code>lvm</code> subcommands but can be invoked as normal commands
without <code>lvm</code> prefix.</p>
<p>NOTE: <code>lvresize</code> can be invoked with <code>-r</code> option to perform FS resize along
with LV resizing.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2025/04/24/python3-polib/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  Â© 2013-2024 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>


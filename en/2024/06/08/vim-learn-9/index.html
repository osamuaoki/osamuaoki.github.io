<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Re-learning Vim (9) | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Re-learning Vim (9)</span></h1>

<h3 class="date">Date:
2024/06/08 (initial publish),
2024/06/08 (last update)
</h3>
<h3 class="source">Source:
en/note-00075.md
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2024/06/04/vim-learn-8/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

<h2>TOC</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#an-example-c-program-with-makefile">An example C program with Makefile</a></li>
    <li><a href="#jump-to-errors-in-the-source-code-c-program-example-with-quickfix">Jump to errors in the source code: C program example with quickfix</a></li>
    <li><a href="#inspect-running-program-direct-gdb">Inspect running program (direct GDB)</a></li>
    <li><a href="#inspect-running-program-direct-dap">Inspect running program (direct DAP)</a></li>
    <li><a href="#jump-to-the-specific-position-in-a-file-generic-vim">Jump to the specific position in a file: generic Vim</a></li>
  </ul>
</nav>

<h2 id="an-example-c-program-with-makefile">An example C program with Makefile</h2>
<p>In order to practice with a simple C program, I created <a href="https://github.com/osamuaoki/osamuaoki-hugo-proj/tree/master/021_gcc_debug"><code>test.c</code> and <code>Makefile</code>
at github</a>.</p>
<p>Let me recap basic GCC options used in this example together with some popular
situation.</p>
<ul>
<li>CPP
<ul>
<li><code>-D_FORTIFY_SOURCE=2</code>: add checks for buffer overflows via CPP
(pre-processor)
<ul>
<li>GCC warns for unused return value for function such as <code>scanf(...)</code> with
this.</li>
</ul>
</li>
</ul>
</li>
<li>GCC optimization
<ul>
<li><code>-O0</code>: default optimization if not specified -&gt; May yield uninitialized variable memory</li>
<li><code>-Og</code>: optimization for debug</li>
<li><code>-O2</code>: optimization for normal use</li>
</ul>
</li>
<li>GCC warning
<ul>
<li><code>-Wall</code>: Enable every warning</li>
<li><code>-Werror</code>: Error for warning</li>
<li><code>-g</code>: Produce debug symbol in the operating system&rsquo;s native format (GDB compatible)</li>
<li><code>-ggdb</code>: Produce debug symbol by GDB (with extra data)</li>
</ul>
</li>
<li>Other GCC notable options</li>
<li><code>-E</code>: Get the preprocessor output only</li>
<li><code>-S</code>: Get the assembly code</li>
<li><code>-V</code>: Get the verbose output of compilation</li>
<li><code>-fPIC</code>: Get a position-independent code</li>
<li><code>-Wl,option</code>: Linker option
<ul>
<li><code>-Wl,-z,relo</code>: pass <code>-z relo</code> to LD.</li>
</ul>
</li>
<li>LD (linker) option
<ul>
<li><code>-l</code>: Link with a shared library
<ul>
<li><code>-lm</code>: link with math library</li>
</ul>
</li>
<li><code>-L</code>: Specify the location of the external library</li>
<li><code>-z relro</code>: memory segment made read-only after relocation</li>
</ul>
</li>
</ul>
<p>Uninitialized variable was zeroed by code generated by <code>-Og</code> and <code>-O2</code> but not
by <code>-O0</code>. So I should use <code>-O2</code> or <code>-Og</code> to make debug easy.</p>
<h2 id="jump-to-errors-in-the-source-code-c-program-example-with-quickfix">Jump to errors in the source code: C program example with quickfix</h2>
<p>Above example compiles without issue.  So let me intensionally break it by
removing <code>;</code> in some lines by editing with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ vi test.c
</span></span></code></pre></div><p>While in Nvim, let me type <code>:make</code> in NORMAL mode.  This runs the content of
<code>Makefile</code> with <code>make</code>.  It sure causes errors and the cursor moves to the
first error position. I can jump around errors with <code>[q</code> and <code>]q</code>.  Cool.</p>
<p>I can also open quickfix list window with <code>:copen</code>.</p>
<p>Pressing ENTER on quickfix list window line jumps cursor to its corresponding
position.</p>
<h2 id="inspect-running-program-direct-gdb">Inspect running program (direct GDB)</h2>
<p>Use of GDB was touched in <a href="/en/2013/08/12/fun2prog-debug-3/">Fun to Program – Debug: level 3</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span>$ gdb -q ./test
</span></span><span style="display:flex;"><span>Reading symbols from ./test...
</span></span><span style="display:flex;"><span>(gdb) list 1,15
</span></span><span style="display:flex;"><span>1	#include &lt;stdlib.h&gt;
</span></span><span style="display:flex;"><span>2	#include &lt;stdio.h&gt;
</span></span><span style="display:flex;"><span>3	int main() {
</span></span><span style="display:flex;"><span>4	  int i, final, factorial = 1;
</span></span><span style="display:flex;"><span>5	  printf(&#34;Enter the number: &#34;);
</span></span><span style="display:flex;"><span>6	  if (scanf(&#34;%d&#34;, &amp;final)) {
</span></span><span style="display:flex;"><span>7	    for (i = 1; i &lt;= final; i++)
</span></span><span style="display:flex;"><span>8	      factorial = factorial * i;
</span></span><span style="display:flex;"><span>9	    printf(&#34;The factorial of %d is %d\n&#34;, final, factorial);
</span></span><span style="display:flex;"><span>10	    exit(0);
</span></span><span style="display:flex;"><span>11	  } else {
</span></span><span style="display:flex;"><span>12	    exit(1);
</span></span><span style="display:flex;"><span>13	  }
</span></span><span style="display:flex;"><span>14	}
</span></span><span style="display:flex;"><span>(gdb) b 8
</span></span><span style="display:flex;"><span>Breakpoint 1 at 0x1199: file test.c, line 8.
</span></span><span style="display:flex;"><span>(gdb) run
</span></span><span style="display:flex;"><span>Starting program: /home/osamu/github/osamuaoki.github.io/osamuaoki-hugo-proj/021_gcc_debug/test
</span></span><span style="display:flex;"><span>[Thread debugging using libthread_db enabled]
</span></span><span style="display:flex;"><span>Using host libthread_db library &#34;/lib/x86_64-linux-gnu/libthread_db.so.1&#34;.
</span></span><span style="display:flex;"><span>Enter the number: 17
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Breakpoint 1, main () at test.c:8
</span></span><span style="display:flex;"><span>8	      factorial = factorial * i;
</span></span><span style="display:flex;"><span>(gdb) info locals
</span></span><span style="display:flex;"><span>i = 1
</span></span><span style="display:flex;"><span>final = 17
</span></span><span style="display:flex;"><span>factorial = 1
</span></span><span style="display:flex;"><span>(gdb) c 16
</span></span><span style="display:flex;"><span>Will ignore next 15 crossings of breakpoint 1.  Continuing.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Breakpoint 1, main () at test.c:8
</span></span><span style="display:flex;"><span>8	      factorial = factorial * i;
</span></span><span style="display:flex;"><span>(gdb) info locals
</span></span><span style="display:flex;"><span>i = 17
</span></span><span style="display:flex;"><span>final = 17
</span></span><span style="display:flex;"><span>factorial = 2004189184
</span></span><span style="display:flex;"><span>(gdb) n
</span></span><span style="display:flex;"><span>7	    for (i = 1; i &lt;= final; i++)
</span></span><span style="display:flex;"><span>(gdb) n
</span></span><span style="display:flex;"><span>9	    printf(&#34;The factorial of %d is %d\n&#34;, final, factorial);
</span></span><span style="display:flex;"><span>(gdb) info locals
</span></span><span style="display:flex;"><span>i = 18
</span></span><span style="display:flex;"><span>final = 17
</span></span><span style="display:flex;"><span>factorial = -288522240
</span></span><span style="display:flex;"><span>(gdb) n
</span></span><span style="display:flex;"><span>The factorial of 17 is -288522240
</span></span><span style="display:flex;"><span>10	    exit(0);
</span></span></code></pre></div><p>Since 17 * 2,004,189,184 =  36,507,221,999, and <code>int</code> is 32 bit signed integer,  overflow occurred (max = 0x7FFF_FFFF= 2,147,483,647).</p>
<h2 id="inspect-running-program-direct-dap">Inspect running program (direct DAP)</h2>
<p>XXX FIXME XXX: document debugger via GDB/DAP/NVIM</p>
<h2 id="jump-to-the-specific-position-in-a-file-generic-vim">Jump to the specific position in a file: generic Vim</h2>
<p>Let me revisit trick to jump to the specific position manually.</p>
<p>To go to line 99 of <code>file.txt</code>, try:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ vim +99 file.txt
</span></span></code></pre></div><p>To go to line 99 column 40 of <code>file.txt</code>, try any one of the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ vim +99 file.txt +<span style="color:#e6db74">&#39;norm 40|&#39;</span>
</span></span><span style="display:flex;"><span>$ vim file.txt +<span style="color:#e6db74">&#39;norm 99G40|&#39;</span>
</span></span><span style="display:flex;"><span>$ vim +<span style="color:#e6db74">&#39;call cursor(99, 40)&#39;</span> file.txt
</span></span></code></pre></div><p>NOTE: <code>|</code> (bar) in NORMAL mode is &ldquo;goto column&rdquo;, and in EX-mode is &ldquo;command
separator&rdquo;.
NOTE: Indexing for line and column in Vim starts at 1. <code>0G</code> is for the last
line.  (List index in Vim Script starts at 0.)</p>
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2024/06/04/vim-learn-8/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  © 2013-2024 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>


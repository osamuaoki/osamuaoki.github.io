<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>python venv | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">python venv</span></h1>

<h3 class="date">Date:
2024/02/02 (initial publish),
2024/02/04 (last update)
</h3>
<h3 class="source">Source:
en/note-00062.md
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2024/01/02/backup-2/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

<h2>TOC</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#python-virtual-environment">Python virtual environment</a></li>
    <li><a href="#setup-keyring">Setup keyring</a></li>
    <li><a href="#setup-twine">Setup Twine</a></li>
    <li><a href="#get-api-token-to-keyring">Get API token to keyring</a></li>
    <li><a href="#failed-test-upload-with-imediff">Failed test upload with <code>imediff</code></a></li>
    <li><a href="#test-upload-of-known-good-package">Test upload of known-good-package</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>

<h2 id="python-virtual-environment">Python virtual environment</h2>
<p>I finally get to use python virtual environment using <code>venv</code> module to be
created under <code>~/.venv/</code>. (I wanted to upload a package to pypi.org)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> $ apt install python3-pip twine
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> $ python3 -m venv ~/.venv
</span></span><span style="display:flex;"><span> $ source ~/.venv/bin/activate
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>.venv<span style="color:#f92672">)</span> $ install --upgrade pip
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>.venv<span style="color:#f92672">)</span> $ install --upgrade twine
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>.venv<span style="color:#f92672">)</span> $ deactivate
</span></span></code></pre></div><p>System packages were current enough to cause printing
<code>Found existing installation: pip 23.0.1</code>,
etc. and no new packages were installed in <code>~/.venv</code>.</p>
<p>Anyway, I now know how to activate and deactivate python virtual environment.</p>
<h2 id="setup-keyring">Setup keyring</h2>
<p>We need to set up access to the keyring tool <code>keyring</code> (backend <code>secret-tool</code>):</p>
<ul>
<li>deb:<code>apt install python3-keyring</code></li>
<li>venv: <code>pip install --upgrade keyring</code></li>
</ul>
<h2 id="setup-twine">Setup Twine</h2>
<p>We need to set up access to the upload tool <code>twine</code>:</p>
<ul>
<li>deb: <code>apt install twine</code></li>
<li>venv: <code>pip install --upgrade twine</code></li>
</ul>
<h2 id="get-api-token-to-keyring">Get API token to keyring</h2>
<p>I got API tokens following their instructions:</p>
<ul>
<li><a href="https://test.pypi.org/help/#apitoken">test.pypi.org API token</a></li>
<li><a href="https://pypi.org/help/#apitoken">pypi.org API token</a></li>
</ul>
<p>I followed <a href="https://twine.readthedocs.io/en/stable/#keyring-support">Twine: Keyring Support</a> to store API tokens into keyring.</p>
<p>For test pypi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> $ keyring set https://test.pypi.org/legacy/ __token__
</span></span><span style="display:flex;"><span>Password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;__token__&#39;</span> in <span style="color:#e6db74">&#39;https://test.pypi.org/legacy/&#39;</span>: pypi-token-value
</span></span></code></pre></div><p>For real pypi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> $ keyring set https://upload.pypi.org/legacy/ __token__
</span></span><span style="display:flex;"><span>Password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;__token__&#39;</span> in <span style="color:#e6db74">&#39;https://upload.pypi.org/legacy/&#39;</span>: pypi-token-value
</span></span></code></pre></div><h2 id="failed-test-upload-with-imediff">Failed test upload with <code>imediff</code></h2>
<p>I followed <a href="https://twine.readthedocs.io/">Twine documentation</a> to build
package for <code>imefiff</code> and upload to test.pypi.org.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> $ cd path/to/imediff
</span></span><span style="display:flex;"><span> $ python3 -m build
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span> Successfully built imediff-2.8.tar.gz and imediff-2.8-py3-none-any.whl
</span></span><span style="display:flex;"><span> $ twine upload --verbose --repository testpypi dist/*
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>ERROR    HTTPError: <span style="color:#ae81ff">400</span> Bad Request from https://test.pypi.org/legacy/
</span></span><span style="display:flex;"><span>         The description failed to render in the default format of reStructuredText. See https://test.pypi.org/help/#description-content-type <span style="color:#66d9ef">for</span> more information.
</span></span></code></pre></div><p>You may use <code>pyproject-build</code> for <code>python3 -m build</code> if deb is installed.</p>
<p>Since keyring is properly setup, this didn&rsquo;t ask password.</p>
<p>I suppose I am doing something wrong: <a href="https://test.pypi.org/help/#description-content-type">Linked site for content-type</a>.</p>
<p>I added <code>README.rst</code>.  No sucess.</p>
<h2 id="test-upload-of-known-good-package">Test upload of known-good-package</h2>
<p>TBD.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://pypi.org/">pypi.org</a> &ndash; real site
<ul>
<li><a href="https://pip.pypa.io/en/stable/">pip documentation</a>
<ul>
<li><a href="https://pip.pypa.io/en/stable/getting-started/">Getting Started</a></li>
<li><a href="https://packaging.python.org/en/latest/">Python Packaging User Guide</a>
<ul>
<li><a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/">Packaging Python Projects</a></li>
<li><a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/#uploading-the-distribution-archivesa">Uploading the distribution archives</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://test.pypi.org/">test.pypi.org</a> &ndash; test site</li>
</ul>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/en/2024/01/02/backup-2/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/en/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  Â© 2013-2023 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>


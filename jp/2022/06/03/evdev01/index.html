<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PC付属キーマップ改善準備 | Goofing Osamu</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/en/">English</a></li>
      
      <li><a href="/jp/">Japanese</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">PC付属キーマップ改善準備</span></h1>

<h3 class="date">Date:
2022/06/03 (initial publish),
2022/06/03 (last update)
</h3>
</div>

<main>


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/jp/2022/05/29/readable-data01/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/jp/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

<h2>TOC</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#キーボード状況">キーボード状況</a></li>
  </ul>
</nav>

<h2 id="キーボード状況">キーボード状況</h2>
<p>確かにQMKを使うと<a href="/jp/2022/03/15/home-mt/">自由にキーマップ</a>が構成でき、動きの少ない手や指にやさしいタイピングができます。</p>
<p>ただ、PC付属キーキーボードででも、同じように<a href="https://precondition.github.io/home-row-mods">HOME ROW MOD</a>等ができないかと言う気になります。</p>
<p><a href="https://gitlab.com/interception/linux/tools">interception-tools</a>を利用し構成する可能性としてはありますが、まだ例が見当たりません。確かに<code>evdev</code>デバイスを通るデーターをフィルター変換で実現するという発想はありです。</p>
<p>ただ、正直分かりにくいので、まず読みやすいPythonの<a href="https://gitlab.com/wsha/chorded_keymap">chorded_keymap</a>を見ました。実際にevdevを通るデーターの実態がよく分からなかったので、この中のプログラムをベースに<a href="https://github.com/osamuaoki/osamu-utils/blob/main/print_kbd_event">データーダンプするユーティリティー</a>を作りました。</p>
<p>確かにほぼ同じ機能のコマンドevtestがあるんですが、この経験をしたことで実態がよく分かりました。</p>
<p>この出力は以下です。</p>
<pre tabindex="0"><code> 12577.98: MSC SCAN 0xcb / KEY LEFT → / SYN REPORT 0
 12577.996: MSC SCAN 0xcb / KEY LEFT ↑ / SYN REPORT 0
 12578.431: MSC SCAN 0xcd / KEY RIGHT ↓ / SYN REPORT 0
 12578.508: MSC SCAN 0xcd / KEY RIGHT ↑ / SYN REPORT 0
 12578.811: MSC SCAN 0xe / KEY BACKSPACE ↓ / SYN REPORT 0
 12578.878: MSC SCAN 0xe / KEY BACKSPACE ↑ / SYN REPORT 0
 12579.346: MSC SCAN 0x11 / KEY W ↓ / SYN REPORT 0
 12579.439: MSC SCAN 0x11 / KEY W ↑ / SYN REPORT 0
 12579.616: MSC SCAN 0x18 / KEY O ↓ / SYN REPORT 0
 12579.69: MSC SCAN 0x18 / KEY O ↑ / SYN REPORT 0
 12579.898: MSC SCAN 0x1c / KEY ENTER ↓ / SYN REPORT 0
 12579.976: MSC SCAN 0x1c / KEY ENTER ↑ / SYN REPORT 0
 12580.125: MSC SCAN 0x1f / KEY S ↓ / SYN REPORT 0
 12580.226: MSC SCAN 0x1f / KEY S ↑ / SYN REPORT 0
 12580.423: MSC SCAN 0x23 / KEY H ↓ / SYN REPORT 0
 12580.494: MSC SCAN 0x23 / KEY H ↑ / SYN REPORT 0
 12580.678: MSC SCAN 0x17 / KEY I ↓ / SYN REPORT 0
 12580.752: MSC SCAN 0x17 / KEY I ↑ / SYN REPORT 0
 12581.067: MSC SCAN 0x14 / KEY T ↓ / SYN REPORT 0
 12581.152: MSC SCAN 0x14 / KEY T ↑ / SYN REPORT 0
 12581.216: MSC SCAN 0x1e / KEY A ↓ / SYN REPORT 0
 12581.316: MSC SCAN 0x1e / KEY A ↑ / SYN REPORT 0
 12581.892: MSC SCAN 0x25 / KEY K ↓ / SYN REPORT 0
 12581.974: MSC SCAN 0x25 / KEY K ↑ / SYN REPORT 0
 12582.155: MSC SCAN 0x18 / KEY O ↓ / SYN REPORT 0
 12582.221: MSC SCAN 0x18 / KEY O ↑ / SYN REPORT 0
 12582.454: MSC SCAN 0x14 / KEY T ↓ / SYN REPORT 0
 12582.525: MSC SCAN 0x14 / KEY T ↑ / SYN REPORT 0
 12582.645: MSC SCAN 0x18 / KEY O ↓ / SYN REPORT 0
 12582.722: MSC SCAN 0x18 / KEY O ↑ / SYN REPORT 0
 12582.854: MSC SCAN 0x20 / KEY D ↓ / SYN REPORT 0
 12582.94: MSC SCAN 0x20 / KEY D ↑ / SYN REPORT 0
 12583.037: MSC SCAN 0x12 / KEY E ↓ / SYN REPORT 0
 12583.121: MSC SCAN 0x12 / KEY E ↑ / SYN REPORT 0
 12583.89: MSC SCAN 0x1c / KEY ENTER ↓ / SYN REPORT 0
 12584.01: MSC SCAN 0x1c / KEY ENTER ↑ / SYN REPORT 0
 12585.08: MSC SCAN 0xcd / KEY RIGHT ↓ / SYN REPORT 0
 12585.345: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.378: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.404: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.436: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.466: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.497: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.525: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
 12585.555: MSC SCAN 0xcd / KEY RIGHT → / SYN REPORT 0
</code></pre><p>気づいたことは:</p>
<ul>
<li>キーを押すと、プレス(↓)となる。</li>
<li>キーを長押しすると、250msぐらいで、リピート(→)となる。リピートは25ms毎ぐらい。</li>
<li>キーを離すと、リリース(↑)となる。</li>
<li>スキャンコードは普通使われない。</li>
<li><code>SYN REPORT 0</code>のおまじないが必ずある。</li>
</ul>
<p>これを頭に、現在で回っている、フィルターを見てみました。</p>
<p>HOME-ROW-MODを考えるなら、CHORDED(併せ押し)ではなく、TAP-HOLD（押しの短長）アプローチです。ただ、それも<a href="https://gitlab.com/interception/linux/plugins/caps2esc">caps2esc</a>等は、press=HOLDで、RELEASEでタイミングが200ms以下ならTAPを出す感じです。CAPSのような端のキーならまだしも、HOME-ROW-MODでこれをするとまともにタイプできません。</p>
<p>TAP-HOLD時間判断はプログラム内で管理が必要かと思っていましたが、あまりフィルターで使われていないリピート(→)を上手く利用すると複雑なEVENT処理無にできそうな気がします。</p>
<p><a href="https://github.com/maricn/interception-vimproved">Interception plugin for vimproved input</a> には、汎用性は無い形ですがレイヤー処理があります。(SPACE-fn)</p>
<p><a href="https://gitlab.com/interception/linux/plugins/dual-function-keys">Dual Function Keys</a>は、TAP-HOLDのスタートや他キーが早くPUSH・RELEASEされた際の対応はいい感じです。他にキー打鍵無い際のHOLD移行にタイマーかREPEATを使わないようなのは気になります。タイミングチャートは参考になります。</p>
<p><a href="https://github.com/zsugabubus/interception-k2k">interception-k2k</a>は、汎用マッパーです。レイヤー機能はありません。設定ファイルがCですが、見通しがいいスタイルですね。REPEATにも対応してそうです。</p>
<!-- raw HTML omitted -->


<table width="100%">
  <tbody>
  <tr>
  
  <td align="left" width="33%"><a href="/jp/2022/05/29/readable-data01/">Previous Post</a></td>
  
  <td align="center" width="33%"><a href="/jp/">Top</a></td>
  
  <td align="right" width="33%"><a href="#">***</a></td>
  
  </tr>
  </tbody>
</table>

</main>

  <footer>
  
  
  <hr/>
  © 2013-2021 <a href="https://github.com/osamuaoki">Osamu Aoki</a>
  
  </footer>
  </body>
</html>

